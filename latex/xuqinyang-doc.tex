%% Generated by Sphinx.
\def\sphinxdocclass{report}
\documentclass[letterpaper,10pt,english]{sphinxmanual}
\ifdefined\pdfpxdimen
   \let\sphinxpxdimen\pdfpxdimen\else\newdimen\sphinxpxdimen
\fi \sphinxpxdimen=.75bp\relax
\ifdefined\pdfimageresolution
    \pdfimageresolution= \numexpr \dimexpr1in\relax/\sphinxpxdimen\relax
\fi
%% let collapsible pdf bookmarks panel have high depth per default
\PassOptionsToPackage{bookmarksdepth=5}{hyperref}

\PassOptionsToPackage{warn}{textcomp}

\catcode`^^^^00a0\active\protected\def^^^^00a0{\leavevmode\nobreak\ }
\usepackage{cmap}
\usepackage{xeCJK}
\usepackage{amsmath,amssymb,amstext}
\usepackage{babel}



\setmainfont{FreeSerif}[
  Extension      = .otf,
  UprightFont    = *,
  ItalicFont     = *Italic,
  BoldFont       = *Bold,
  BoldItalicFont = *BoldItalic
]
\setsansfont{FreeSans}[
  Extension      = .otf,
  UprightFont    = *,
  ItalicFont     = *Oblique,
  BoldFont       = *Bold,
  BoldItalicFont = *BoldOblique,
]
\setmonofont{FreeMono}[
  Extension      = .otf,
  UprightFont    = *,
  ItalicFont     = *Oblique,
  BoldFont       = *Bold,
  BoldItalicFont = *BoldOblique,
]



\usepackage[Sonny]{fncychap}
\ChNameVar{\Large\normalfont\sffamily}
\ChTitleVar{\Large\normalfont\sffamily}
\usepackage{sphinx}

\fvset{fontsize=\small,formatcom=\xeCJKVerbAddon}
\usepackage{geometry}


% Include hyperref last.
\usepackage{hyperref}
% Fix anchor placement for figures with captions.
\usepackage{hypcap}% it must be loaded after hyperref.
% Set up styles of URL: it should be placed after hyperref.
\urlstyle{same}

\addto\captionsenglish{\renewcommand{\contentsname}{Contents:}}

\usepackage{sphinxmessages}
\setcounter{tocdepth}{5}
\setcounter{secnumdepth}{5}
\usepackage[UTF8]{ctex}


\title{xuqinyang\sphinxhyphen{}doc}
\date{2022 年 06 月 26 日}
\release{0.0.1}
\author{xuqinyang}
\newcommand{\sphinxlogo}{\vbox{}}
\renewcommand{\releasename}{发布}
\makeindex
\begin{document}

\ifdefined\shorthandoff
  \ifnum\catcode`\=\string=\active\shorthandoff{=}\fi
  \ifnum\catcode`\"=\active\shorthandoff{"}\fi
\fi

\pagestyle{empty}
\sphinxmaketitle
\pagestyle{plain}
\sphinxtableofcontents
\pagestyle{normal}
\phantomsection\label{\detokenize{index::doc}}


\sphinxstepscope


\chapter{Python}
\label{\detokenize{python/index:python}}\label{\detokenize{python/index::doc}}
\sphinxstepscope


\section{常规}
\label{\detokenize{python/common/contents:id1}}\label{\detokenize{python/common/contents::doc}}
\sphinxstepscope


\section{机器学习}
\label{\detokenize{python/machinelearning/contents:id1}}\label{\detokenize{python/machinelearning/contents::doc}}
\sphinxstepscope


\section{其他}
\label{\detokenize{python/else/contents:id1}}\label{\detokenize{python/else/contents::doc}}
\sphinxstepscope


\chapter{前端＆后端}
\label{\detokenize{qianduanandhouduan/index:id1}}\label{\detokenize{qianduanandhouduan/index::doc}}
\sphinxstepscope


\section{前端}
\label{\detokenize{qianduanandhouduan/qianduan/contents:id1}}\label{\detokenize{qianduanandhouduan/qianduan/contents::doc}}
\sphinxstepscope


\section{后端}
\label{\detokenize{qianduanandhouduan/houduan/contents:id1}}\label{\detokenize{qianduanandhouduan/houduan/contents::doc}}
\sphinxstepscope


\section{其他}
\label{\detokenize{qianduanandhouduan/qita/contents:id1}}\label{\detokenize{qianduanandhouduan/qita/contents::doc}}

\subsection{Github Action}
\label{\detokenize{qianduanandhouduan/qita/contents:github-action}}

\subsubsection{一、sphinx的自动构建}
\label{\detokenize{qianduanandhouduan/qita/contents:sphinx}}

\paragraph{1. 一些说明}
\label{\detokenize{qianduanandhouduan/qita/contents:id2}}
\sphinxAtStartPar
​		想找个地方记录一下，看到许多python项目的文档是用sphinx写的，用一些平台托管自己的文档感觉不太自由，于是打算自己搭建一个。由于sphinx构建生成的都是静态页面，因此可以使用Github Pages托管。

\sphinxAtStartPar
​		如果每次都在本地修改项目源码，然后本地构建，再将源代码上传至Github备份，静态页面部署至Github Pages，不免觉得有些麻烦，偶然间发现了Github Action功能（\textasciitilde{}\textasciitilde{}这不是直接白嫖服务器吗\textasciitilde{}\textasciitilde{}），使用Github Action进行构建和部署，这样我只需要将初始源代码上传至Github，然后想要修改或写文章的时候直接在Github上改。然后全自动更新Github Pages，并且可以随时回滚版本。


\paragraph{2. 一些坑}
\label{\detokenize{qianduanandhouduan/qita/contents:id3}}
\sphinxAtStartPar
​		① 在Github Marketplace上搜到的sphinx自动构建的Acition大多都不能使用或版本老旧（需要修改许多地方），并且所有都不支持markdown（需要加装个库）

\sphinxAtStartPar
​		② 使用Github Pages默认的jekyll会导致sphinx构建的js与css无法访问（因为jekyll会不会使用\_开头的文件/文件夹，而sphinx构建的js与css存放在\_static中），因此需要禁用jekyll

\sphinxAtStartPar
​		③sphinx几个库的版本要注意（之前因为版本直接不兼容导致搜索功能无法使用）


\paragraph{3. 主要代码}
\label{\detokenize{qianduanandhouduan/qita/contents:id4}}
\sphinxAtStartPar
sphinx项目文件放入docs目录下

\sphinxAtStartPar
/.github/workflows/Build\&Deploy.yml——启动

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n+nt}{name}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{Build\PYGZam{}Deploy}
\PYG{n+nt}{on}\PYG{p}{:}
\PYG{+w}{  }\PYG{n+nt}{pull\PYGZus{}request}\PYG{p}{:}
\PYG{+w}{    }\PYG{n+nt}{branches}\PYG{p}{:}\PYG{+w}{ }\PYG{p+pIndicator}{[}\PYG{+w}{ }\PYG{n+nv}{master}\PYG{+w}{ }\PYG{p+pIndicator}{]}
\PYG{+w}{  }\PYG{n+nt}{workflow\PYGZus{}dispatch}\PYG{p}{:}
\PYG{+w}{  }\PYG{n+nt}{push}\PYG{p}{:}
\PYG{+w}{    }\PYG{n+nt}{branches}\PYG{p}{:}
\PYG{+w}{      }\PYG{p+pIndicator}{\PYGZhy{}}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{master}
\PYG{n+nt}{jobs}\PYG{p}{:}
\PYG{+w}{  }\PYG{n+nt}{build\PYGZhy{}Github}\PYG{p}{:}
\PYG{+w}{    }\PYG{n+nt}{runs\PYGZhy{}on}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{ubuntu\PYGZhy{}latest}
\PYG{+w}{    }\PYG{n+nt}{steps}\PYG{p}{:}
\PYG{+w}{      }\PYG{p+pIndicator}{\PYGZhy{}}\PYG{+w}{ }\PYG{n+nt}{uses}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{actions/checkout@v2}
\PYG{+w}{      }\PYG{c+c1}{\PYGZsh{} Setup Conda}
\PYG{+w}{      }\PYG{p+pIndicator}{\PYGZhy{}}\PYG{+w}{ }\PYG{n+nt}{uses}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{conda\PYGZhy{}incubator/setup\PYGZhy{}miniconda@v2}
\PYG{+w}{        }\PYG{n+nt}{with}\PYG{p}{:}
\PYG{+w}{          }\PYG{n+nt}{python\PYGZhy{}version}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{3.7}
\PYG{+w}{      }\PYG{c+c1}{\PYGZsh{} Runs this action}
\PYG{+w}{      }\PYG{p+pIndicator}{\PYGZhy{}}\PYG{+w}{ }\PYG{n+nt}{uses}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{./}
\PYG{+w}{        }\PYG{n+nt}{with}\PYG{p}{:}
\PYG{+w}{          }\PYG{n+nt}{package\PYGZus{}name}\PYG{p}{:}\PYG{+w}{ }\PYG{l+s}{\PYGZsq{}}\PYG{l+s}{other\PYGZus{}example}\PYG{l+s}{\PYGZsq{}}
\PYG{+w}{      }\PYG{p+pIndicator}{\PYGZhy{}}\PYG{+w}{ }\PYG{n+nt}{uses}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{actions/download\PYGZhy{}artifact@v2}
\PYG{+w}{      }\PYG{p+pIndicator}{\PYGZhy{}}\PYG{+w}{ }\PYG{n+nt}{name}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{Check}\PYG{l+lScalar+lScalarPlain}{ }\PYG{l+lScalar+lScalarPlain}{Artifacts}
\PYG{+w}{        }\PYG{n+nt}{run}\PYG{p}{:}\PYG{+w}{ }\PYG{p+pIndicator}{|}
\PYG{+w}{          }\PYG{n+no}{ls \PYGZhy{}al}
\PYG{+w}{          }\PYG{n+no}{if [ ! \PYGZhy{}e documentation ]; then}
\PYG{+w}{            }\PYG{n+no}{echo \PYGZdq{}documentation artifact not found\PYGZdq{}}
\PYG{+w}{            }\PYG{n+no}{exit 1}
\PYG{+w}{          }\PYG{n+no}{fi}
\PYG{+w}{          }\PYG{n+no}{ls \PYGZhy{}al documentation}
\end{sphinxVerbatim}

\sphinxAtStartPar
/action.yml——主workflow，配置环境，构建，上传至doc分支，发布到release

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n+nt}{name}\PYG{p}{:}\PYG{+w}{ }\PYG{l+s}{\PYGZsq{}}\PYG{l+s}{Build}\PYG{n+nv}{ }\PYG{l+s}{sphinx}\PYG{n+nv}{ }\PYG{l+s}{docs}\PYG{l+s}{\PYGZsq{}}
\PYG{n+nt}{description}\PYG{p}{:}\PYG{+w}{ }\PYG{l+s}{\PYGZsq{}}\PYG{l+s}{Builds}\PYG{n+nv}{ }\PYG{l+s}{IDS}\PYG{n+nv}{ }\PYG{l+s}{Sphinx}\PYG{n+nv}{ }\PYG{l+s}{documentation}\PYG{l+s}{\PYGZsq{}}
\PYG{n+nt}{permissions}\PYG{p}{:}\PYG{+w}{ }
\PYG{+w}{  }\PYG{n+nt}{contents}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{write}
\PYG{n+nt}{inputs}\PYG{p}{:}
\PYG{+w}{  }\PYG{n+nt}{docs\PYGZus{}path}\PYG{p}{:}\PYG{+w}{ }\PYG{c+c1}{\PYGZsh{} id of input}
\PYG{+w}{    }\PYG{n+nt}{description}\PYG{p}{:}\PYG{+w}{ }\PYG{l+s}{\PYGZsq{}}\PYG{l+s}{The}\PYG{n+nv}{ }\PYG{l+s}{path}\PYG{n+nv}{ }\PYG{l+s}{to}\PYG{n+nv}{ }\PYG{l+s}{the}\PYG{n+nv}{ }\PYG{l+s}{documentation}\PYG{n+nv}{ }\PYG{l+s}{folder}\PYG{n+nv}{ }\PYG{l+s}{from}\PYG{n+nv}{ }\PYG{l+s}{the}\PYG{n+nv}{ }\PYG{l+s}{repo}\PYG{n+nv}{ }\PYG{l+s}{root}\PYG{l+s}{\PYGZsq{}}
\PYG{+w}{    }\PYG{n+nt}{required}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{false}
\PYG{+w}{    }\PYG{n+nt}{default}\PYG{p}{:}\PYG{+w}{ }\PYG{l+s}{\PYGZsq{}}\PYG{l+s}{docs}\PYG{l+s}{\PYGZsq{}}
\PYG{+w}{  }\PYG{n+nt}{conda\PYGZus{}build\PYGZus{}env\PYGZus{}filepath}\PYG{p}{:}
\PYG{+w}{    }\PYG{n+nt}{description}\PYG{p}{:}\PYG{+w}{ }\PYG{l+s}{\PYGZsq{}}\PYG{l+s}{Yaml}\PYG{n+nv}{ }\PYG{l+s}{Conda}\PYG{n+nv}{ }\PYG{l+s}{build}\PYG{n+nv}{ }\PYG{l+s}{environment}\PYG{n+nv}{ }\PYG{l+s}{definition}\PYG{n+nv}{ }\PYG{l+s}{file}\PYG{l+s}{\PYGZsq{}}
\PYG{+w}{    }\PYG{n+nt}{required}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{false}
\PYG{+w}{    }\PYG{n+nt}{default}\PYG{p}{:}\PYG{+w}{ }\PYG{l+s}{\PYGZsq{}}\PYG{l+s}{action\PYGZus{}default}\PYG{l+s}{\PYGZsq{}}
\PYG{+w}{  }\PYG{n+nt}{conda\PYGZus{}build\PYGZus{}env\PYGZus{}name}\PYG{p}{:}
\PYG{+w}{    }\PYG{n+nt}{description}\PYG{p}{:}\PYG{+w}{ }\PYG{l+s}{\PYGZsq{}}\PYG{l+s}{Name}\PYG{n+nv}{ }\PYG{l+s}{of}\PYG{n+nv}{ }\PYG{l+s}{the}\PYG{n+nv}{ }\PYG{l+s}{build}\PYG{n+nv}{ }\PYG{l+s}{conda}\PYG{n+nv}{ }\PYG{l+s}{environment}\PYG{l+s}{\PYGZsq{}}
\PYG{+w}{    }\PYG{n+nt}{required}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{false}
\PYG{+w}{    }\PYG{n+nt}{default}\PYG{p}{:}\PYG{+w}{ }\PYG{l+s}{\PYGZsq{}}\PYG{l+s}{action\PYGZus{}default}\PYG{l+s}{\PYGZsq{}}
\PYG{+w}{  }\PYG{n+nt}{base\PYGZus{}env\PYGZus{}prefix}\PYG{p}{:}\PYG{+w}{  }\PYG{c+c1}{\PYGZsh{} id of input}
\PYG{+w}{    }\PYG{n+nt}{description}\PYG{p}{:}\PYG{+w}{ }\PYG{l+s}{\PYGZsq{}}\PYG{l+s}{The}\PYG{n+nv}{ }\PYG{l+s}{prefix}\PYG{n+nv}{ }\PYG{l+s}{of}\PYG{n+nv}{ }\PYG{l+s}{the}\PYG{n+nv}{ }\PYG{l+s}{base}\PYG{n+nv}{ }\PYG{l+s}{Conda}\PYG{n+nv}{ }\PYG{l+s}{environment}\PYG{n+nv}{ }\PYG{l+s}{for}\PYG{n+nv}{ }\PYG{l+s}{self\PYGZhy{}hosted}\PYG{n+nv}{ }\PYG{l+s}{runs.}\PYG{l+s}{\PYGZsq{}}
\PYG{+w}{    }\PYG{n+nt}{required}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{false}
\PYG{+w}{    }\PYG{n+nt}{default}\PYG{p}{:}\PYG{+w}{ }\PYG{l+s}{\PYGZsq{}}\PYG{l+s}{/usr/share/miniconda}\PYG{l+s}{\PYGZsq{}}
\PYG{+w}{  }\PYG{n+nt}{artifact\PYGZus{}name}\PYG{p}{:}
\PYG{+w}{    }\PYG{n+nt}{description}\PYG{p}{:}\PYG{+w}{ }\PYG{l+s}{\PYGZsq{}}\PYG{l+s}{Display}\PYG{n+nv}{ }\PYG{l+s}{name}\PYG{n+nv}{ }\PYG{l+s}{of}\PYG{n+nv}{ }\PYG{l+s}{the}\PYG{n+nv}{ }\PYG{l+s}{documentation}\PYG{n+nv}{ }\PYG{l+s}{artifact}\PYG{l+s}{\PYGZsq{}}
\PYG{+w}{    }\PYG{n+nt}{required}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{false}
\PYG{+w}{    }\PYG{n+nt}{default}\PYG{p}{:}\PYG{+w}{ }\PYG{l+s}{\PYGZsq{}}\PYG{l+s}{documentation}\PYG{l+s}{\PYGZsq{}}
\PYG{+w}{  }\PYG{n+nt}{package\PYGZus{}folder\PYGZus{}path}\PYG{p}{:}
\PYG{+w}{    }\PYG{n+nt}{description}\PYG{p}{:}\PYG{+w}{ }\PYG{l+s}{\PYGZsq{}}\PYG{l+s}{Path}\PYG{n+nv}{ }\PYG{l+s}{to}\PYG{n+nv}{ }\PYG{l+s}{the}\PYG{n+nv}{ }\PYG{l+s}{folder}\PYG{n+nv}{ }\PYG{l+s}{containing}\PYG{n+nv}{ }\PYG{l+s}{the}\PYG{n+nv}{ }\PYG{l+s}{project}\PYG{l+s+se}{\PYGZsq{}\PYGZsq{}}\PYG{l+s}{s}\PYG{n+nv}{ }\PYG{l+s}{package(s)}\PYG{n+nv}{ }\PYG{l+s}{to}\PYG{n+nv}{ }\PYG{l+s}{be}\PYG{n+nv}{ }\PYG{l+s}{installed}\PYG{l+s}{\PYGZsq{}}
\PYG{+w}{    }\PYG{n+nt}{required}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{false}
\PYG{+w}{    }\PYG{n+nt}{default}\PYG{p}{:}\PYG{+w}{ }\PYG{l+s}{\PYGZsq{}}\PYG{l+s}{conda\PYGZus{}package}\PYG{l+s}{\PYGZsq{}}
\PYG{+w}{  }\PYG{n+nt}{package\PYGZus{}name}\PYG{p}{:}
\PYG{+w}{    }\PYG{n+nt}{description}\PYG{p}{:}\PYG{+w}{ }\PYG{l+s}{\PYGZsq{}}\PYG{l+s}{Name}\PYG{n+nv}{ }\PYG{l+s}{of}\PYG{n+nv}{ }\PYG{l+s}{the}\PYG{n+nv}{ }\PYG{l+s}{project}\PYG{l+s+se}{\PYGZsq{}\PYGZsq{}}\PYG{l+s}{s}\PYG{n+nv}{ }\PYG{l+s}{Conda}\PYG{n+nv}{ }\PYG{l+s}{package}\PYG{l+s}{\PYGZsq{}}
\PYG{+w}{    }\PYG{n+nt}{required}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{false}
\PYG{+w}{    }\PYG{n+nt}{default}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{\PYGZdl{}\PYGZob{}\PYGZob{}}\PYG{l+lScalar+lScalarPlain}{ }\PYG{l+lScalar+lScalarPlain}{github.event.repository.name}\PYG{l+lScalar+lScalarPlain}{ }\PYG{l+lScalar+lScalarPlain}{\PYGZcb{}\PYGZcb{}}
\PYG{n+nt}{outputs}\PYG{p}{:}
\PYG{+w}{  }\PYG{n+nt}{filepath}\PYG{p}{:}
\PYG{+w}{    }\PYG{n+nt}{description}\PYG{p}{:}\PYG{+w}{ }\PYG{l+s}{\PYGZsq{}}\PYG{l+s}{The}\PYG{n+nv}{ }\PYG{l+s}{file}\PYG{n+nv}{ }\PYG{l+s}{path}\PYG{n+nv}{ }\PYG{l+s}{of}\PYG{n+nv}{ }\PYG{l+s}{the}\PYG{n+nv}{ }\PYG{l+s}{generated}\PYG{n+nv}{ }\PYG{l+s}{HTML}\PYG{n+nv}{ }\PYG{l+s}{documentation}\PYG{l+s}{\PYGZsq{}}
\PYG{+w}{    }\PYG{n+nt}{value}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{\PYGZdl{}\PYGZob{}\PYGZob{}}\PYG{l+lScalar+lScalarPlain}{ }\PYG{l+lScalar+lScalarPlain}{steps.main.outputs.filepath}\PYG{l+lScalar+lScalarPlain}{ }\PYG{l+lScalar+lScalarPlain}{\PYGZcb{}\PYGZcb{}}
\PYG{n+nt}{runs}\PYG{p}{:}
\PYG{+w}{  }\PYG{n+nt}{using}\PYG{p}{:}\PYG{+w}{ }\PYG{l+s}{\PYGZdq{}}\PYG{l+s}{composite}\PYG{l+s}{\PYGZdq{}}
\PYG{+w}{  }\PYG{n+nt}{steps}\PYG{p}{:}
\PYG{+w}{    }\PYG{p+pIndicator}{\PYGZhy{}}\PYG{+w}{ }\PYG{n+nt}{uses}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{actions/checkout@v2.2.0}
\PYG{+w}{      }\PYG{n+nt}{with}\PYG{p}{:}
\PYG{+w}{        }\PYG{n+nt}{fetch\PYGZhy{}depth}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{0}\PYG{+w}{ }\PYG{c+c1}{\PYGZsh{} Required due to the way Git works, without it this action won\PYGZsq{}t be able to find any or the correct tags}
\PYG{+w}{    }\PYG{p+pIndicator}{\PYGZhy{}}\PYG{+w}{ }\PYG{n+nt}{uses}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{actions/download\PYGZhy{}artifact@v2}
\PYG{+w}{      }\PYG{n+nt}{with}\PYG{p}{:}
\PYG{+w}{        }\PYG{n+nt}{path}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{artifacts}
\PYG{+w}{    }\PYG{p+pIndicator}{\PYGZhy{}}\PYG{+w}{ }\PYG{n+nt}{id}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{main}
\PYG{+w}{      }\PYG{n+nt}{run}\PYG{p}{:}\PYG{+w}{ }\PYG{p+pIndicator}{|}
\PYG{+w}{        }\PYG{n+no}{echo \PYGZdq{}::set\PYGZhy{}output name=filepath::\PYGZdl{}(echo \PYGZdq{}None\PYGZdq{})\PYGZdq{}}
\PYG{+w}{        }\PYG{n+no}{echo \PYGZdq{}CHECKS\PYGZdq{}}
\PYG{+w}{        }\PYG{n+no}{echo \PYGZdq{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZdq{}}
\PYG{+w}{        }\PYG{n+no}{if [ \PYGZhy{}d \PYGZdl{}\PYGZob{}\PYGZob{} inputs.docs\PYGZus{}path \PYGZcb{}\PYGZcb{} ]; then}
\PYG{+w}{          }\PYG{n+no}{echo \PYGZdq{}  Found the docs folder at \PYGZdl{}\PYGZob{}\PYGZob{} inputs.docs\PYGZus{}path \PYGZcb{}\PYGZcb{}\PYGZdq{}}
\PYG{+w}{        }\PYG{n+no}{else}
\PYG{+w}{          }\PYG{n+no}{echo \PYGZdq{}  ERROR: Unable to locate the docs path, \PYGZdl{}\PYGZob{}\PYGZob{} inputs.docs\PYGZus{}path \PYGZcb{}\PYGZcb{}. Skipping the build of the docs.\PYGZdq{}}
\PYG{+w}{          }\PYG{n+no}{exit 0}
\PYG{+w}{        }\PYG{n+no}{fi}
\PYG{+w}{        }\PYG{n+no}{echo \PYGZdq{}\PYGZdq{}}
\PYG{+w}{        }\PYG{n+no}{echo \PYGZdq{}Selecting Build Env yml File\PYGZdq{}}
\PYG{+w}{        }\PYG{n+no}{if [ \PYGZdl{}\PYGZob{}\PYGZob{} inputs.conda\PYGZus{}build\PYGZus{}env\PYGZus{}filepath \PYGZcb{}\PYGZcb{} = \PYGZsq{}action\PYGZus{}default\PYGZsq{} ]; then}
\PYG{+w}{          }\PYG{n+no}{echo \PYGZdq{}Using the default conda configuration\PYGZdq{}}
\PYG{+w}{          }\PYG{n+no}{CONDA\PYGZus{}BUILD\PYGZus{}ENV\PYGZus{}FILE=\PYGZdq{}\PYGZdl{}\PYGZob{}\PYGZob{} github.action\PYGZus{}path \PYGZcb{}\PYGZcb{}/envs/build\PYGZhy{}docs.yml\PYGZdq{}}
\PYG{+w}{        }\PYG{n+no}{elif [ \PYGZhy{}f \PYGZdl{}\PYGZob{}\PYGZob{} inputs.conda\PYGZus{}build\PYGZus{}env\PYGZus{}filepath \PYGZcb{}\PYGZcb{} ]; then}
\PYG{+w}{          }\PYG{n+no}{CONDA\PYGZus{}BUILD\PYGZus{}ENV\PYGZus{}FILE=\PYGZdl{}\PYGZob{}\PYGZob{} inputs.conda\PYGZus{}build\PYGZus{}env\PYGZus{}filepath \PYGZcb{}\PYGZcb{}}
\PYG{+w}{        }\PYG{n+no}{else}
\PYG{+w}{          }\PYG{n+no}{echo \PYGZdq{}Using the default conda configuration\PYGZdq{}}
\PYG{+w}{          }\PYG{n+no}{CONDA\PYGZus{}BUILD\PYGZus{}ENV\PYGZus{}FILE=\PYGZdq{}\PYGZdl{}\PYGZob{}\PYGZob{} github.action\PYGZus{}path \PYGZcb{}\PYGZcb{}/envs/build\PYGZhy{}docs.yml\PYGZdq{}}
\PYG{+w}{        }\PYG{n+no}{fi}
\PYG{+w}{        }\PYG{n+no}{echo \PYGZdq{}CONDA\PYGZus{}BUILD\PYGZus{}ENV\PYGZus{}FILE: \PYGZdl{}\PYGZob{}CONDA\PYGZus{}BUILD\PYGZus{}ENV\PYGZus{}FILE\PYGZcb{}\PYGZdq{}}
\PYG{+w}{        }\PYG{n+no}{cat \PYGZdq{}\PYGZdl{}\PYGZob{}CONDA\PYGZus{}BUILD\PYGZus{}ENV\PYGZus{}FILE\PYGZcb{}\PYGZdq{}}

\PYG{+w}{        }\PYG{n+no}{echo \PYGZsq{}source \PYGZdl{}\PYGZob{}\PYGZob{} inputs.base\PYGZus{}env\PYGZus{}prefix \PYGZcb{}\PYGZcb{}/etc/profile.d/conda.sh\PYGZsq{}}
\PYG{+w}{        }\PYG{n+no}{source \PYGZdl{}\PYGZob{}\PYGZob{} inputs.base\PYGZus{}env\PYGZus{}prefix \PYGZcb{}\PYGZcb{}/etc/profile.d/conda.sh}
\PYG{+w}{        }\PYG{n+no}{echo \PYGZdq{}Checking that Conda is initialized\PYGZdq{}}
\PYG{+w}{        }\PYG{n+no}{if ! command \PYGZhy{}v conda \PYGZam{}\PYGZgt{} /dev/null; then}
\PYG{+w}{          }\PYG{n+no}{echo \PYGZdq{}ERROR: Conda is not setup.\PYGZdq{}}
\PYG{+w}{          }\PYG{n+no}{exit 1}
\PYG{+w}{        }\PYG{n+no}{fi}
\PYG{+w}{        }\PYG{n+no}{echo \PYGZdq{}  Conda is initialized\PYGZdq{}}

\PYG{+w}{        }\PYG{n+no}{echo \PYGZdq{}Conda build docs env name\PYGZdq{}}
\PYG{+w}{        }\PYG{n+no}{if [ \PYGZdl{}\PYGZob{}\PYGZob{} inputs.conda\PYGZus{}build\PYGZus{}env\PYGZus{}name \PYGZcb{}\PYGZcb{} = \PYGZsq{}action\PYGZus{}default\PYGZsq{} ]; then}
\PYG{+w}{          }\PYG{n+no}{echo \PYGZdq{}Using the default conda build env name: \PYGZdl{}\PYGZob{}\PYGZob{} github.event.repository.name \PYGZcb{}\PYGZcb{}\PYGZhy{}build\PYGZhy{}docs\PYGZdq{}}
\PYG{+w}{          }\PYG{n+no}{CONDA\PYGZus{}BUILD\PYGZus{}ENV\PYGZus{}NAME=\PYGZdq{}\PYGZdl{}\PYGZob{}\PYGZob{} github.event.repository.name \PYGZcb{}\PYGZcb{}\PYGZhy{}build\PYGZhy{}docs\PYGZdq{}}
\PYG{+w}{        }\PYG{n+no}{else}
\PYG{+w}{          }\PYG{n+no}{echo \PYGZdq{}Using the provided conda build env name: \PYGZdl{}\PYGZob{}\PYGZob{} inputs.conda\PYGZus{}build\PYGZus{}env\PYGZus{}name  \PYGZcb{}\PYGZcb{}\PYGZdq{}}
\PYG{+w}{          }\PYG{n+no}{CONDA\PYGZus{}BUILD\PYGZus{}ENV\PYGZus{}NAME=\PYGZdq{}\PYGZdl{}\PYGZob{}\PYGZob{} inputs.conda\PYGZus{}build\PYGZus{}env\PYGZus{}name  \PYGZcb{}\PYGZcb{}\PYGZdq{}}
\PYG{+w}{        }\PYG{n+no}{fi}

\PYG{+w}{        }\PYG{n+no}{echo \PYGZdq{}\PYGZdq{}}
\PYG{+w}{        }\PYG{n+no}{echo \PYGZdq{}SETUP BUILD ENV\PYGZdq{}}
\PYG{+w}{        }\PYG{n+no}{echo \PYGZdq{}Set source\PYGZdq{}}
\PYG{+w}{        }\PYG{n+no}{echo \PYGZdq{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZdq{}}
\PYG{+w}{        }\PYG{n+no}{echo \PYGZdq{}Setting up \PYGZdl{}\PYGZob{}\PYGZob{} github.event.repository.name \PYGZcb{}\PYGZcb{}\PYGZhy{}build environment\PYGZdq{}}
\PYG{+w}{        }\PYG{n+no}{conda env update \PYGZhy{}\PYGZhy{}name \PYGZdl{}\PYGZob{}CONDA\PYGZus{}BUILD\PYGZus{}ENV\PYGZus{}NAME\PYGZcb{} \PYGZbs{}}
\PYG{+w}{                         }\PYG{n+no}{\PYGZhy{}\PYGZhy{}file \PYGZdq{}\PYGZdl{}\PYGZob{}CONDA\PYGZus{}BUILD\PYGZus{}ENV\PYGZus{}FILE\PYGZcb{}\PYGZdq{}  || \PYGZbs{}}
\PYG{+w}{            }\PYG{n+no}{conda env create \PYGZhy{}f \PYGZdq{}\PYGZdl{}\PYGZob{}CONDA\PYGZus{}BUILD\PYGZus{}ENV\PYGZus{}FILE\PYGZcb{}\PYGZdq{}}
\PYG{+w}{        }\PYG{n+no}{conda activate \PYGZdl{}\PYGZob{}CONDA\PYGZus{}BUILD\PYGZus{}ENV\PYGZus{}NAME\PYGZcb{}}
\PYG{+w}{        }\PYG{n+no}{ls \PYGZhy{}al \PYGZdl{}\PYGZob{}\PYGZob{} inputs.package\PYGZus{}folder\PYGZus{}path \PYGZcb{}\PYGZcb{}}
\PYG{+w}{        }\PYG{n+no}{echo \PYGZdq{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZdq{}}
\PYG{+w}{        }\PYG{n+no}{if [ \PYGZhy{}a \PYGZdl{}\PYGZob{}\PYGZob{} inputs.package\PYGZus{}folder\PYGZus{}path \PYGZcb{}\PYGZcb{}/\PYGZdl{}\PYGZob{}\PYGZob{} inputs.package\PYGZus{}name \PYGZcb{}\PYGZcb{}\PYGZhy{}*.bz2 ]; then}
\PYG{+w}{          }\PYG{n+no}{conda update conda\PYGZhy{}build || conda install conda\PYGZhy{}build}
\PYG{+w}{          }\PYG{n+no}{echo \PYGZdq{}Installing project package\PYGZdq{}}
\PYG{+w}{          }\PYG{n+no}{CHANNEL\PYGZus{}PATH=\PYGZdq{}\PYGZdl{}\PYGZob{}\PYGZob{}runner.temp\PYGZcb{}\PYGZcb{}/channel/linux\PYGZhy{}64\PYGZdq{}}
\PYG{+w}{          }\PYG{n+no}{mkdir \PYGZhy{}p \PYGZdq{}\PYGZdl{}\PYGZob{}CHANNEL\PYGZus{}PATH\PYGZcb{}\PYGZdq{}}
\PYG{+w}{          }\PYG{n+no}{cp \PYGZdl{}\PYGZob{}\PYGZob{} inputs.package\PYGZus{}folder\PYGZus{}path \PYGZcb{}\PYGZcb{}/\PYGZdl{}\PYGZob{}\PYGZob{} inputs.package\PYGZus{}name \PYGZcb{}\PYGZcb{}\PYGZhy{}*.bz2 \PYGZdl{}\PYGZob{}CHANNEL\PYGZus{}PATH\PYGZcb{}}
\PYG{+w}{          }\PYG{n+no}{conda index \PYGZdq{}\PYGZdl{}\PYGZob{}CHANNEL\PYGZus{}PATH\PYGZcb{}\PYGZdq{}}
\PYG{+w}{          }\PYG{n+no}{conda update \PYGZhy{}c \PYGZdq{}\PYGZdl{}\PYGZob{}CHANNEL\PYGZus{}PATH\PYGZcb{}\PYGZdq{} \PYGZdl{}\PYGZob{}\PYGZob{} inputs.package\PYGZus{}name \PYGZcb{}\PYGZcb{} || \PYGZbs{}}
\PYG{+w}{            }\PYG{n+no}{conda install \PYGZhy{}c \PYGZdq{}\PYGZdl{}\PYGZob{}CHANNEL\PYGZus{}PATH\PYGZcb{}\PYGZdq{} \PYGZdl{}\PYGZob{}\PYGZob{} inputs.package\PYGZus{}name \PYGZcb{}\PYGZcb{} || \PYGZbs{}}
\PYG{+w}{            }\PYG{n+no}{(conda uninstall \PYGZdl{}\PYGZob{}\PYGZob{} inputs.package\PYGZus{}name \PYGZcb{}\PYGZcb{} \PYGZam{}\PYGZam{} \PYGZbs{}}
\PYG{+w}{              }\PYG{n+no}{conda install \PYGZhy{}c \PYGZdq{}\PYGZdl{}\PYGZob{}CHANNEL\PYGZus{}PATH\PYGZcb{}\PYGZdq{} \PYGZdl{}\PYGZob{}\PYGZob{} inputs.package\PYGZus{}name \PYGZcb{}\PYGZcb{})}

\PYG{+w}{        }\PYG{n+no}{else}
\PYG{+w}{          }\PYG{n+no}{echo \PYGZdq{}Did not install project package\PYGZdq{}}
\PYG{+w}{        }\PYG{n+no}{fi}
\PYG{+w}{        }\PYG{n+no}{echo \PYGZdq{}\PYGZdq{}}
\PYG{+w}{        }\PYG{n+no}{echo \PYGZdq{}conda info\PYGZdq{}}
\PYG{+w}{        }\PYG{n+no}{conda info}
\PYG{+w}{        }\PYG{n+no}{echo \PYGZdq{}\PYGZdq{}}
\PYG{+w}{        }\PYG{n+no}{echo \PYGZdq{}conda list\PYGZdq{}}
\PYG{+w}{        }\PYG{n+no}{conda list}

\PYG{+w}{        }\PYG{n+no}{echo \PYGZdq{}\PYGZdq{}}
\PYG{+w}{        }\PYG{n+no}{echo \PYGZdq{}BUILD DOCS\PYGZdq{}}
\PYG{+w}{        }\PYG{n+no}{echo \PYGZdq{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZdq{}}
\PYG{+w}{        }\PYG{n+no}{cd \PYGZdl{}\PYGZob{}\PYGZob{} inputs.docs\PYGZus{}path \PYGZcb{}\PYGZcb{}}
\PYG{+w}{        }\PYG{n+no}{if [ \PYGZhy{}e \PYGZdq{}./setup\PYGZus{}source.sh\PYGZdq{} ]; then}
\PYG{+w}{          }\PYG{n+no}{./setup\PYGZus{}source.sh}
\PYG{+w}{        }\PYG{n+no}{fi}
\PYG{+w}{        }\PYG{n+no}{make html}
\PYG{+w}{        }\PYG{n+no}{dir}
\PYG{+w}{        }\PYG{n+no}{tar \PYGZhy{}cvf build.tar build}
\PYG{+w}{        }\PYG{n+no}{gzip \PYGZhy{}9 build.tar}
\PYG{+w}{        }\PYG{n+no}{zip \PYGZhy{}q \PYGZhy{}r build.zip build}
\PYG{+w}{        }\PYG{n+no}{echo \PYGZdq{}::set\PYGZhy{}output name=filepath::\PYGZdl{}(echo \PYGZsq{}\PYGZdl{}\PYGZob{}\PYGZob{} inputs.docs\PYGZus{}path \PYGZcb{}\PYGZcb{}/build/html\PYGZsq{})\PYGZdq{}}
\PYG{+w}{      }\PYG{n+nt}{shell}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{bash}\PYG{l+lScalar+lScalarPlain}{ }\PYG{l+lScalar+lScalarPlain}{\PYGZhy{}l}\PYG{l+lScalar+lScalarPlain}{ }\PYG{l+lScalar+lScalarPlain}{\PYGZob{}0\PYGZcb{}}
\PYG{+w}{    }\PYG{p+pIndicator}{\PYGZhy{}}\PYG{+w}{ }\PYG{n+nt}{uses}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{actions/upload\PYGZhy{}artifact@v2}
\PYG{+w}{      }\PYG{n+nt}{with}\PYG{p}{:}
\PYG{+w}{        }\PYG{n+nt}{name}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{\PYGZdl{}\PYGZob{}\PYGZob{}}\PYG{l+lScalar+lScalarPlain}{ }\PYG{l+lScalar+lScalarPlain}{inputs.artifact\PYGZus{}name}\PYG{l+lScalar+lScalarPlain}{ }\PYG{l+lScalar+lScalarPlain}{\PYGZcb{}\PYGZcb{}}
\PYG{+w}{        }\PYG{n+nt}{path}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{docs/build/html}
\PYG{+w}{    }\PYG{p+pIndicator}{\PYGZhy{}}\PYG{+w}{ }\PYG{n+nt}{id}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{mkdir123}
\PYG{+w}{      }\PYG{n+nt}{run}\PYG{p}{:}\PYG{+w}{ }\PYG{p+pIndicator}{|}
\PYG{+w}{        }\PYG{n+no}{mkdir \PYGZhy{}p docs/build/html}
\PYG{+w}{      }\PYG{n+nt}{shell}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{bash}\PYG{l+lScalar+lScalarPlain}{ }\PYG{l+lScalar+lScalarPlain}{\PYGZhy{}l}\PYG{l+lScalar+lScalarPlain}{ }\PYG{l+lScalar+lScalarPlain}{\PYGZob{}0\PYGZcb{}}
\PYG{+w}{    }\PYG{p+pIndicator}{\PYGZhy{}}\PYG{+w}{ }\PYG{n+nt}{uses}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{JamesIves/github\PYGZhy{}pages\PYGZhy{}deploy\PYGZhy{}action@v4.3.3}
\PYG{+w}{      }\PYG{n+nt}{with}\PYG{p}{:}
\PYG{+w}{        }\PYG{n+nt}{branch}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{doc}
\PYG{+w}{        }\PYG{n+nt}{folder}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{docs/build/html}
\PYG{+w}{    }\PYG{p+pIndicator}{\PYGZhy{}}\PYG{+w}{ }\PYG{n+nt}{id}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{previoustag}
\PYG{+w}{      }\PYG{n+nt}{uses}\PYG{p}{:}\PYG{+w}{ }\PYG{l+s}{\PYGZdq{}}\PYG{l+s}{WyriHaximus/github\PYGZhy{}action\PYGZhy{}get\PYGZhy{}previous\PYGZhy{}tag@v1}\PYG{l+s}{\PYGZdq{}}
\PYG{+w}{      }\PYG{n+nt}{with}\PYG{p}{:}
\PYG{+w}{        }\PYG{n+nt}{fallback}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{1.0.0}\PYG{+w}{ }\PYG{c+c1}{\PYGZsh{} Optional fallback tag to use when no tag can be found}
\PYG{+w}{    }\PYG{p+pIndicator}{\PYGZhy{}}\PYG{+w}{ }\PYG{n+nt}{id}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{semvers}
\PYG{+w}{      }\PYG{n+nt}{uses}\PYG{p}{:}\PYG{+w}{ }\PYG{l+s}{\PYGZdq{}}\PYG{l+s}{WyriHaximus/github\PYGZhy{}action\PYGZhy{}next\PYGZhy{}semvers@v1}\PYG{l+s}{\PYGZdq{}}
\PYG{+w}{      }\PYG{n+nt}{with}\PYG{p}{:}
\PYG{+w}{        }\PYG{n+nt}{version}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{\PYGZdl{}\PYGZob{}\PYGZob{}}\PYG{l+lScalar+lScalarPlain}{ }\PYG{l+lScalar+lScalarPlain}{steps.previoustag.outputs.tag}\PYG{l+lScalar+lScalarPlain}{ }\PYG{l+lScalar+lScalarPlain}{\PYGZcb{}\PYGZcb{}}
\PYG{+w}{    }\PYG{p+pIndicator}{\PYGZhy{}}\PYG{+w}{ }\PYG{n+nt}{uses}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{ncipollo/release\PYGZhy{}action@v1}
\PYG{+w}{      }\PYG{n+nt}{with}\PYG{p}{:}
\PYG{+w}{        }\PYG{n+nt}{allowUpdates}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{true}
\PYG{+w}{        }\PYG{n+nt}{tag}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{\PYGZdl{}\PYGZob{}\PYGZob{}}\PYG{l+lScalar+lScalarPlain}{ }\PYG{l+lScalar+lScalarPlain}{steps.semvers.outputs.patch}\PYG{l+lScalar+lScalarPlain}{ }\PYG{l+lScalar+lScalarPlain}{\PYGZcb{}\PYGZcb{}}
\PYG{+w}{        }\PYG{n+nt}{name}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{Release}\PYG{l+lScalar+lScalarPlain}{ }\PYG{l+lScalar+lScalarPlain}{\PYGZdl{}\PYGZob{}\PYGZob{}}\PYG{l+lScalar+lScalarPlain}{ }\PYG{l+lScalar+lScalarPlain}{steps.semvers.outputs.v\PYGZus{}patch}\PYG{l+lScalar+lScalarPlain}{ }\PYG{l+lScalar+lScalarPlain}{\PYGZcb{}\PYGZcb{}}
\PYG{+w}{        }\PYG{n+nt}{artifacts}\PYG{p}{:}\PYG{+w}{ }\PYG{p+pIndicator}{|}
\PYG{+w}{          }\PYG{n+no}{docs/build.zip}
\PYG{+w}{          }\PYG{n+no}{docs/build.tar.gz}
\end{sphinxVerbatim}

\sphinxAtStartPar
/envs/build\sphinxhyphen{}docs.yml——需要的库

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n+nt}{name}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{build\PYGZhy{}docs}
\PYG{n+nt}{channels}\PYG{p}{:}
\PYG{+w}{  }\PYG{p+pIndicator}{\PYGZhy{}}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{defaults}
\PYG{+w}{  }\PYG{p+pIndicator}{\PYGZhy{}}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{conda\PYGZhy{}forge}
\PYG{n+nt}{dependencies}\PYG{p}{:}
\PYG{+w}{  }\PYG{p+pIndicator}{\PYGZhy{}}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{conda=4.9.2}
\PYG{+w}{  }\PYG{p+pIndicator}{\PYGZhy{}}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{pip}
\PYG{+w}{  }\PYG{p+pIndicator}{\PYGZhy{}}\PYG{+w}{ }\PYG{n+nt}{pip}\PYG{p}{:}
\PYG{+w}{    }\PYG{p+pIndicator}{\PYGZhy{}}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{sphinx\PYGZus{}markdown\PYGZus{}tables==0.0.15}
\PYG{+w}{    }\PYG{p+pIndicator}{\PYGZhy{}}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{sphinx==4.5.0}
\PYG{+w}{    }\PYG{p+pIndicator}{\PYGZhy{}}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{recommonmark==0.7.1}
\PYG{+w}{    }\PYG{p+pIndicator}{\PYGZhy{}}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{sphinx\PYGZus{}rtd\PYGZus{}theme==1.0.0}
\PYG{+w}{    }\PYG{p+pIndicator}{\PYGZhy{}}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{sphinx\PYGZhy{}panels==0.6.0}
\PYG{+w}{    }\PYG{p+pIndicator}{\PYGZhy{}}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{sphinx\PYGZhy{}autobuild}
\PYG{+w}{    }\PYG{p+pIndicator}{\PYGZhy{}}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{sphinx\PYGZhy{}click==4.2.0}
\PYG{+w}{    }\PYG{p+pIndicator}{\PYGZhy{}}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{sphinx\PYGZhy{}copybutton}
\end{sphinxVerbatim}


\paragraph{4. 成果}
\label{\detokenize{qianduanandhouduan/qita/contents:id5}}
\sphinxAtStartPar
https://xqy2006.github.io/docs


\subsubsection{二、基于Github Action和Github Issue的音乐生成}
\label{\detokenize{qianduanandhouduan/qita/contents:github-actiongithub-issue}}

\paragraph{1. 一些说明}
\label{\detokenize{qianduanandhouduan/qita/contents:id6}}
\sphinxAtStartPar
​		之前写过一个前端(Vue)+后端(Flask)版的，无奈服务器终有一天会到期，由于有着做\sphinxhref{https://xqy2006.github.io/docs/\%E5\%89\%8D\%E7\%AB\%AF\%EF\%BC\%86\%E5\%90\%8E\%E7\%AB\%AF/\%E5\%85\%B6\%E4\%BB\%96/contents.html\#sphinx}{第一个项目}的经验，所以想到了使用Github Action作为后端，但是如果自己写前端的话势必需要对Github进行一些操作才能触发workflow，而对Github进行一些操作又需要登录Github账号，太麻烦了，有可能还会导致token泄露，不如直接使用Github自带的Issue作为自己的前端（\textasciitilde{}\textasciitilde{}其实是懒得写\textasciitilde{}\textasciitilde{}）


\paragraph{2. 一些坑}
\label{\detokenize{qianduanandhouduan/qita/contents:id7}}
\sphinxAtStartPar
​		①numpy绝对是大坑，各种版本不兼容（因此没有将packages上传至仓库）

\sphinxAtStartPar
​		②issue是markdown的输入markdown的输出，因此需要对body进行一些处理（yaml几乎没有对字符串处理的能力，只能交给脚本了）

\sphinxAtStartPar
​		③一定要等待Github Pages部署完毕后再评论，要不然结果还未部署用户就有可能发起下载请求


\paragraph{3. 主要代码}
\label{\detokenize{qianduanandhouduan/qita/contents:id8}}
\sphinxAtStartPar
训练过程省略，直接推理

\sphinxAtStartPar
由于Github最大文件限制为100M，故将模型压缩

\sphinxAtStartPar
music.py——推理主程序

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{zipfile}
 
\PYG{n}{f} \PYG{o}{=} \PYG{n}{zipfile}\PYG{o}{.}\PYG{n}{ZipFile}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{./Midi\PYGZus{}Model/best\PYGZus{}model.zip}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{r}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)} \PYG{c+c1}{\PYGZsh{} 压缩文件位置}
\PYG{k}{for} \PYG{n}{file} \PYG{o+ow}{in} \PYG{n}{f}\PYG{o}{.}\PYG{n}{namelist}\PYG{p}{(}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{f}\PYG{o}{.}\PYG{n}{extract}\PYG{p}{(}\PYG{n}{file}\PYG{p}{,}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{./Midi\PYGZus{}Model/}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}               \PYG{c+c1}{\PYGZsh{} 解压位置}
\PYG{n}{f}\PYG{o}{.}\PYG{n}{close}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{f} \PYG{o}{=} \PYG{n}{zipfile}\PYG{o}{.}\PYG{n}{ZipFile}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{./Midi\PYGZus{}Model/final\PYGZus{}model.zip}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{r}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)} \PYG{c+c1}{\PYGZsh{} 压缩文件位置}
\PYG{k}{for} \PYG{n}{file} \PYG{o+ow}{in} \PYG{n}{f}\PYG{o}{.}\PYG{n}{namelist}\PYG{p}{(}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{f}\PYG{o}{.}\PYG{n}{extract}\PYG{p}{(}\PYG{n}{file}\PYG{p}{,}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{./Midi\PYGZus{}Model/}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}               \PYG{c+c1}{\PYGZsh{} 解压位置}
\PYG{n}{f}\PYG{o}{.}\PYG{n}{close}\PYG{p}{(}\PYG{p}{)}
\PYG{k+kn}{import} \PYG{n+nn}{sys}
\PYG{n+nb}{input} \PYG{o}{=} \PYG{n}{sys}\PYG{o}{.}\PYG{n}{argv}\PYG{p}{[}\PYG{l+m+mi}{3}\PYG{p}{]}
\PYG{k+kn}{import} \PYG{n+nn}{os}
\PYG{k+kn}{import} \PYG{n+nn}{json}
\PYG{k+kn}{from} \PYG{n+nn}{music21} \PYG{k+kn}{import} \PYG{o}{*}
\PYG{k+kn}{import} \PYG{n+nn}{base64}
\PYG{k+kn}{import} \PYG{n+nn}{paddle}
\PYG{k+kn}{import} \PYG{n+nn}{paddle}\PYG{n+nn}{.}\PYG{n+nn}{nn} \PYG{k}{as} \PYG{n+nn}{nn}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{k+kn}{from} \PYG{n+nn}{Reader} \PYG{k+kn}{import} \PYG{n}{Reader}
\PYG{k+kn}{import} \PYG{n+nn}{Seq2Seq}
\PYG{k+kn}{from} \PYG{n+nn}{binascii} \PYG{k+kn}{import} \PYG{n}{b2a\PYGZus{}hex}

\PYG{n}{batch\PYGZus{}size} \PYG{o}{=} \PYG{l+m+mi}{10}
\PYG{n}{train\PYGZus{}reader} \PYG{o}{=} \PYG{n}{Reader}\PYG{p}{(}\PYG{n}{batch\PYGZus{}size}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{./work/data}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{k+kn}{import} \PYG{n+nn}{json}
\PYG{k+kn}{import} \PYG{n+nn}{time}
\PYG{c+c1}{\PYGZsh{} 初始化log写入器}

\PYG{c+c1}{\PYGZsh{} 模型参数设置}
\PYG{n}{embedding\PYGZus{}size} \PYG{o}{=} \PYG{l+m+mi}{256}
\PYG{n}{hidden\PYGZus{}size} \PYG{o}{=} \PYG{l+m+mi}{256}
\PYG{n}{num\PYGZus{}layers} \PYG{o}{=} \PYG{l+m+mi}{1}

\PYG{c+c1}{\PYGZsh{} 训练参数设置}
\PYG{n}{epoch\PYGZus{}num} \PYG{o}{=} \PYG{l+m+mi}{5000}
\PYG{n}{learning\PYGZus{}rate} \PYG{o}{=} \PYG{l+m+mf}{1e\PYGZhy{}5}
\PYG{n}{log\PYGZus{}iter} \PYG{o}{=} \PYG{l+m+mi}{200}

\PYG{c+c1}{\PYGZsh{} 定义一些所需变量}
\PYG{n}{global\PYGZus{}step} \PYG{o}{=} \PYG{l+m+mi}{0}
\PYG{n}{log\PYGZus{}step} \PYG{o}{=} \PYG{l+m+mi}{0}
\PYG{n}{max\PYGZus{}acc} \PYG{o}{=} \PYG{l+m+mi}{0}

\PYG{n}{midi\PYGZus{}model} \PYG{o}{=} \PYG{n}{Seq2Seq}\PYG{o}{.}\PYG{n}{Midi\PYGZus{}Model}\PYG{p}{(}
    \PYG{n}{char\PYGZus{}len}\PYG{o}{=}\PYG{l+m+mh}{0x9FFF}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{} 基本汉字的Unicode码范围为4E00\PYGZhy{}9FA5,这里设置0x9FFF长，基本够用}
    \PYG{n}{embedding\PYGZus{}size}\PYG{o}{=}\PYG{n}{embedding\PYGZus{}size}\PYG{p}{,}
    \PYG{n}{hidden\PYGZus{}size}\PYG{o}{=}\PYG{n}{hidden\PYGZus{}size}\PYG{p}{,}
    \PYG{n}{num\PYGZus{}layers}\PYG{o}{=}\PYG{n}{num\PYGZus{}layers}\PYG{p}{,}
    \PYG{n}{batch\PYGZus{}size}\PYG{o}{=}\PYG{n}{batch\PYGZus{}size}\PYG{p}{)}
\PYG{n}{dur\PYGZus{}model} \PYG{o}{=} \PYG{n}{Seq2Seq}\PYG{o}{.}\PYG{n}{Duration\PYGZus{}Model}\PYG{p}{(}
    \PYG{n}{char\PYGZus{}len}\PYG{o}{=}\PYG{l+m+mi}{200}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{} midi范围一般在100左右,这里设置200长，基本够用}
    \PYG{n}{embedding\PYGZus{}size}\PYG{o}{=}\PYG{n}{embedding\PYGZus{}size}\PYG{p}{,}
    \PYG{n}{hidden\PYGZus{}size}\PYG{o}{=}\PYG{n}{hidden\PYGZus{}size}\PYG{p}{,}
    \PYG{n}{num\PYGZus{}layers}\PYG{o}{=}\PYG{n}{num\PYGZus{}layers}\PYG{p}{,}
    \PYG{n}{batch\PYGZus{}size}\PYG{o}{=}\PYG{n}{batch\PYGZus{}size}\PYG{p}{)}
\PYG{n}{midi\PYGZus{}model}\PYG{o}{.}\PYG{n}{set\PYGZus{}state\PYGZus{}dict}\PYG{p}{(}\PYG{n}{paddle}\PYG{o}{.}\PYG{n}{load}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Midi\PYGZus{}Model/final\PYGZus{}model}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{dur\PYGZus{}model}\PYG{o}{.}\PYG{n}{set\PYGZus{}state\PYGZus{}dict}\PYG{p}{(}\PYG{n}{paddle}\PYG{o}{.}\PYG{n}{load}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Duration\PYGZus{}Model/final\PYGZus{}model}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{input\PYGZus{}lyrics} \PYG{o}{=} \PYG{n+nb}{input}
\PYG{n}{lyrics} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{k}{for} \PYG{n}{i}\PYG{p}{,} \PYG{n}{lyric} \PYG{o+ow}{in} \PYG{n+nb}{enumerate}\PYG{p}{(}\PYG{n}{input\PYGZus{}lyrics}\PYG{o}{.}\PYG{n}{replace}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+se}{\PYGZbs{}n}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{if} \PYG{n}{i} \PYG{o}{\PYGZpc{}} \PYG{n}{batch\PYGZus{}size} \PYG{o}{==} \PYG{l+m+mi}{0}\PYG{p}{:}
        \PYG{n}{lyrics}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{p}{[}\PYG{p}{]}\PYG{p}{)}
    \PYG{n}{lyrics}\PYG{p}{[}\PYG{n}{i} \PYG{o}{/}\PYG{o}{/} \PYG{n}{batch\PYGZus{}size}\PYG{p}{]}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n+nb}{ord}\PYG{p}{(}\PYG{n}{lyric}\PYG{p}{)}\PYG{p}{)}
\PYG{k}{while} \PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{lyrics}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)} \PYG{o}{\PYGZpc{}} \PYG{n}{batch\PYGZus{}size} \PYG{o}{!=} \PYG{l+m+mi}{0}\PYG{p}{:}
    \PYG{n}{lyrics}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n+nb}{ord}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{lyrics} \PYG{o}{=} \PYG{n}{paddle}\PYG{o}{.}\PYG{n}{to\PYGZus{}tensor}\PYG{p}{(}\PYG{n}{lyrics}\PYG{p}{)}

\PYG{n}{params\PYGZus{}dict} \PYG{o}{=} \PYG{n}{paddle}\PYG{o}{.}\PYG{n}{load}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Midi\PYGZus{}Model/best\PYGZus{}model}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{midi\PYGZus{}model}\PYG{o}{.}\PYG{n}{set\PYGZus{}dict}\PYG{p}{(}\PYG{n}{params\PYGZus{}dict}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} 设置为评估模式}
\PYG{n}{midi\PYGZus{}model}\PYG{o}{.}\PYG{n}{eval}\PYG{p}{(}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} 模型推理}
\PYG{n}{out} \PYG{o}{=} \PYG{n}{midi\PYGZus{}model}\PYG{p}{(}\PYG{n}{lyrics}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} 结果转换}
\PYG{n}{results} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{k}{for} \PYG{n}{\PYGZus{}} \PYG{o+ow}{in} \PYG{n}{np}\PYG{o}{.}\PYG{n}{argmax}\PYG{p}{(}\PYG{n}{out}\PYG{o}{.}\PYG{n}{numpy}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,} \PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{o}{.}\PYG{n}{reshape}\PYG{p}{(}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{results}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{\PYGZus{}}\PYG{p}{)}

\PYG{n}{midis} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{dur\PYGZus{}dic} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{p}{\PYGZcb{}}
\PYG{k}{with} \PYG{n+nb}{open}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{dur\PYGZus{}dic.json}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{r}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)} \PYG{k}{as} \PYG{n}{f}\PYG{p}{:}
    \PYG{n}{dur\PYGZus{}str} \PYG{o}{=} \PYG{n}{f}\PYG{o}{.}\PYG{n}{readline}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{dur\PYGZus{}dic} \PYG{o}{=} \PYG{n}{json}\PYG{o}{.}\PYG{n}{loads}\PYG{p}{(}\PYG{n}{dur\PYGZus{}str}\PYG{p}{)}
\PYG{k}{for} \PYG{n}{i}\PYG{p}{,} \PYG{n}{midi} \PYG{o+ow}{in} \PYG{n+nb}{enumerate}\PYG{p}{(}\PYG{n}{results}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{if} \PYG{n}{i} \PYG{o}{\PYGZpc{}} \PYG{n}{batch\PYGZus{}size} \PYG{o}{==} \PYG{l+m+mi}{0}\PYG{p}{:}
        \PYG{n}{midis}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{p}{[}\PYG{p}{]}\PYG{p}{)}
    \PYG{n}{midis}\PYG{p}{[}\PYG{n}{i} \PYG{o}{/}\PYG{o}{/} \PYG{n}{batch\PYGZus{}size}\PYG{p}{]}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{midi}\PYG{p}{)} \PYG{k}{if} \PYG{n}{midi} \PYG{o}{\PYGZlt{}}\PYG{o}{=} \PYG{l+m+mi}{200} \PYG{k}{else} \PYG{n}{midis}\PYG{p}{[}\PYG{n}{i} \PYG{o}{/}\PYG{o}{/} \PYG{n}{batch\PYGZus{}size}\PYG{p}{]}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{)}
\PYG{k}{while} \PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{midis}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)} \PYG{o}{\PYGZpc{}} \PYG{n}{batch\PYGZus{}size} \PYG{o}{!=} \PYG{l+m+mi}{0}\PYG{p}{:}
    \PYG{n}{midis}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{)}
\PYG{n}{midis} \PYG{o}{=} \PYG{n}{paddle}\PYG{o}{.}\PYG{n}{to\PYGZus{}tensor}\PYG{p}{(}\PYG{n}{midis}\PYG{p}{)}

\PYG{n}{params\PYGZus{}dict} \PYG{o}{=} \PYG{n}{paddle}\PYG{o}{.}\PYG{n}{load}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Duration\PYGZus{}Model/best\PYGZus{}model}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{dur\PYGZus{}model}\PYG{o}{.}\PYG{n}{set\PYGZus{}dict}\PYG{p}{(}\PYG{n}{params\PYGZus{}dict}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} 设置为评估模式}
\PYG{n}{dur\PYGZus{}model}\PYG{o}{.}\PYG{n}{eval}\PYG{p}{(}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} 模型推理}
\PYG{c+c1}{\PYGZsh{} out = nn.Softmax(dur\PYGZus{}model(midis))}
\PYG{n}{out} \PYG{o}{=} \PYG{n}{dur\PYGZus{}model}\PYG{p}{(}\PYG{n}{midis}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} 结果转换}
\PYG{n}{durations} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{k}{for} \PYG{n}{\PYGZus{}} \PYG{o+ow}{in} \PYG{n}{np}\PYG{o}{.}\PYG{n}{argmax}\PYG{p}{(}\PYG{n}{out}\PYG{o}{.}\PYG{n}{numpy}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,} \PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{o}{.}\PYG{n}{reshape}\PYG{p}{(}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{durations}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{\PYGZus{}}\PYG{p}{)}

\PYG{n}{dur\PYGZus{}dic} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{p}{\PYGZcb{}}
\PYG{k}{with} \PYG{n+nb}{open}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{dur\PYGZus{}dic.json}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{r}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)} \PYG{k}{as} \PYG{n}{f}\PYG{p}{:}
    \PYG{n}{dur\PYGZus{}str} \PYG{o}{=} \PYG{n}{f}\PYG{o}{.}\PYG{n}{readline}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{dur\PYGZus{}dic} \PYG{o}{=} \PYG{n}{json}\PYG{o}{.}\PYG{n}{loads}\PYG{p}{(}\PYG{n}{dur\PYGZus{}str}\PYG{p}{)}
    \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{dur\PYGZus{}dic}\PYG{p}{)}

\PYG{n}{stream1} \PYG{o}{=} \PYG{n}{stream}\PYG{o}{.}\PYG{n}{Stream}\PYG{p}{(}\PYG{p}{)}
\PYG{k}{for} \PYG{n}{i}\PYG{p}{,} \PYG{n}{lyric} \PYG{o+ow}{in} \PYG{n+nb}{enumerate}\PYG{p}{(}\PYG{n}{input\PYGZus{}lyrics}\PYG{o}{.}\PYG{n}{replace}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+se}{\PYGZbs{}n}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{if} \PYG{n}{results}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]} \PYG{o}{!=} \PYG{l+m+mi}{0}\PYG{p}{:}
        \PYG{n}{n1} \PYG{o}{=} \PYG{n}{note}\PYG{o}{.}\PYG{n}{Note}\PYG{p}{(}\PYG{n}{results}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{)}
    \PYG{k}{else}\PYG{p}{:}
        \PYG{n}{n1} \PYG{o}{=} \PYG{n}{note}\PYG{o}{.}\PYG{n}{Rest}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{n1}\PYG{o}{.}\PYG{n}{addLyric}\PYG{p}{(}\PYG{n}{lyric}\PYG{p}{)}
    \PYG{n}{n1}\PYG{o}{.}\PYG{n}{duration} \PYG{o}{=} \PYG{n}{duration}\PYG{o}{.}\PYG{n}{Duration}\PYG{p}{(}\PYG{n}{dur\PYGZus{}dic}\PYG{p}{[}\PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{durations}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{)}\PYG{p}{]}\PYG{p}{)}
    \PYG{n}{stream1}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{n1}\PYG{p}{)}
\PYG{k+kn}{import} \PYG{n+nn}{random}
\PYG{n}{name} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsq{}}
\PYG{n}{stream1}\PYG{o}{.}\PYG{n}{write}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{xml}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{./result/}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n}{sys}\PYG{o}{.}\PYG{n}{argv}\PYG{p}{[}\PYG{l+m+mi}{4}\PYG{p}{]} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{.xml}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{n}{stream1}\PYG{o}{.}\PYG{n}{write}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{midi}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{./result/}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n}{sys}\PYG{o}{.}\PYG{n}{argv}\PYG{p}{[}\PYG{l+m+mi}{4}\PYG{p}{]} \PYG{o}{+} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{.midi}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{output} \PYG{o}{=} \PYG{n+nb}{input} \PYG{o}{+} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{.midi}\PYG{l+s+s1}{\PYGZsq{}}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{output}\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxAtStartPar
verify.py——校验输入是否全部为中文字符，若不是则报错，由verify.yml进行后续操作

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{sys}
\PYG{n+nb}{input} \PYG{o}{=} \PYG{n}{sys}\PYG{o}{.}\PYG{n}{argv}\PYG{p}{[}\PYG{l+m+mi}{3}\PYG{p}{]}
\PYG{k}{def} \PYG{n+nf}{check\PYGZus{}contain\PYGZus{}chinese}\PYG{p}{(}\PYG{n}{check\PYGZus{}str}\PYG{p}{)}\PYG{p}{:}
	\PYG{k}{for} \PYG{n}{ch} \PYG{o+ow}{in} \PYG{n}{check\PYGZus{}str}\PYG{p}{:}
		\PYG{k}{if} \PYG{l+s+sa}{u}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+se}{\PYGZbs{}u4e00}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{\PYGZlt{}}\PYG{o}{=} \PYG{n}{ch} \PYG{o}{\PYGZlt{}}\PYG{o}{=} \PYG{l+s+sa}{u}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+se}{\PYGZbs{}u9f5a}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:}
			\PYG{k}{pass}
		\PYG{k}{else}\PYG{p}{:}
			\PYG{k}{return} \PYG{k+kc}{True}
	\PYG{k}{return} \PYG{k+kc}{False}
\PYG{k}{if} \PYG{n}{check\PYGZus{}contain\PYGZus{}chinese}\PYG{p}{(}\PYG{n+nb}{input}\PYG{p}{)}\PYG{p}{:}
	\PYG{k}{raise} \PYG{n+ne}{Exception}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{error}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxAtStartPar
sleep.py——等待Github Pages部署完成后再回复

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{requests}
\PYG{k+kn}{import} \PYG{n+nn}{os}
\PYG{k+kn}{import} \PYG{n+nn}{urllib3}
\PYG{k+kn}{import} \PYG{n+nn}{time}
\PYG{n}{urllib3}\PYG{o}{.}\PYG{n}{disable\PYGZus{}warnings}\PYG{p}{(}\PYG{p}{)}
\PYG{k+kn}{import} \PYG{n+nn}{sys}
\PYG{k}{def} \PYG{n+nf}{download}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}\PYG{p}{:}
  \PYG{n}{headers} \PYG{o}{=} \PYG{p}{\PYGZob{}}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{User\PYGZhy{}Agent}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Mozilla/5.0 (Windows NT 10.0; WOW64; rv:68.0) Gecko/20100101 Firefox/68.0}\PYG{l+s+s2}{\PYGZdq{}}
  \PYG{p}{\PYGZcb{}}
  \PYG{n}{r} \PYG{o}{=} \PYG{n}{requests}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{url}\PYG{o}{=}\PYG{n}{url}\PYG{p}{,} \PYG{n}{headers}\PYG{o}{=}\PYG{n}{headers}\PYG{p}{,}\PYG{n}{verify}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{)}
  \PYG{k}{return} \PYG{n}{r}\PYG{o}{.}\PYG{n}{status\PYGZus{}code}
\PYG{k}{while} \PYG{n}{download}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{http://xqy2006.github.io/music\PYGZus{}generation/}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{+}\PYG{n}{sys}\PYG{o}{.}\PYG{n}{argv}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{+}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{.xml}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{==}\PYG{l+m+mi}{404}\PYG{p}{:}
  \PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Page undeploy}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
  \PYG{n}{time}\PYG{o}{.}\PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{finish}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxAtStartPar
/.github/ISSUE\_TEMPLATE/music\_generation.yml——问题模板

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n+nt}{name}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{音乐生成}
\PYG{n+nt}{description}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{音乐生成}
\PYG{n+nt}{title}\PYG{p}{:}\PYG{+w}{ }\PYG{l+s}{\PYGZdq{}}\PYG{l+s}{音乐生成}\PYG{l+s}{\PYGZdq{}}
\PYG{n+nt}{labels}\PYG{p}{:}\PYG{+w}{ }\PYG{p+pIndicator}{[}\PYG{l+s}{\PYGZdq{}}\PYG{l+s}{music\PYGZus{}generation}\PYG{l+s}{\PYGZdq{}}\PYG{p+pIndicator}{]}
\PYG{n+nt}{body}\PYG{p}{:}
\PYG{+w}{  }\PYG{p+pIndicator}{\PYGZhy{}}\PYG{+w}{ }\PYG{n+nt}{type}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{textarea}
\PYG{+w}{    }\PYG{n+nt}{id}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{input\PYGZus{}text}
\PYG{+w}{    }\PYG{n+nt}{attributes}\PYG{p}{:}
\PYG{+w}{      }\PYG{n+nt}{label}\PYG{p}{:}\PYG{+w}{ }\PYG{l+s}{\PYGZdq{}}\PYG{l+s}{歌词}\PYG{l+s}{\PYGZdq{}}
\PYG{+w}{      }\PYG{n+nt}{description}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{请输入要谱曲的歌词（只能是中文，无标点）：}
\PYG{+w}{      }\PYG{n+nt}{placeholder}\PYG{p}{:}\PYG{+w}{ }
\PYG{+w}{      }\PYG{n+nt}{value}\PYG{p}{:}\PYG{+w}{ }
\PYG{+w}{    }\PYG{n+nt}{validations}\PYG{p}{:}
\PYG{+w}{      }\PYG{n+nt}{required}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{true}
\end{sphinxVerbatim}

\sphinxAtStartPar
music\_generation/.github/workflows/music.yml——主workflow，将issue的body与id传入python处理，push生成结果文件到store分支构建Github Pages，回复并关闭issue

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n+nt}{name}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{music}
\PYG{n+nt}{on}\PYG{p}{:}
\PYG{+w}{  }\PYG{n+nt}{issues}\PYG{p}{:}
\PYG{+w}{    }\PYG{n+nt}{types}\PYG{p}{:}\PYG{+w}{ }\PYG{p+pIndicator}{[}\PYG{n+nv}{opened}\PYG{p+pIndicator}{,}\PYG{n+nv}{edited}\PYG{p+pIndicator}{]}
\PYG{+w}{  }\PYG{n+nt}{workflow\PYGZus{}dispatch}\PYG{p}{:}
\PYG{n+nt}{jobs}\PYG{p}{:}
\PYG{+w}{  }\PYG{n+nt}{build}\PYG{p}{:}

\PYG{+w}{    }\PYG{n+nt}{runs\PYGZhy{}on}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{ubuntu\PYGZhy{}latest}

\PYG{+w}{    }\PYG{n+nt}{steps}\PYG{p}{:}
\PYG{+w}{    }\PYG{p+pIndicator}{\PYGZhy{}}\PYG{+w}{ }\PYG{n+nt}{uses}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{actions/checkout@v2}
\PYG{+w}{    }\PYG{p+pIndicator}{\PYGZhy{}}\PYG{+w}{ }\PYG{n+nt}{run}\PYG{p}{:}\PYG{+w}{ }\PYG{p+pIndicator}{|}
\PYG{+w}{          }\PYG{n+no}{mkdir \PYGZhy{}p ./id}
\PYG{+w}{          }\PYG{n+no}{echo \PYGZdl{}ID \PYGZgt{} ./id/id}
\PYG{+w}{      }\PYG{n+nt}{env}\PYG{p}{:}
\PYG{+w}{          }\PYG{n+nt}{ID}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{\PYGZdl{}\PYGZob{}\PYGZob{}}\PYG{l+lScalar+lScalarPlain}{ }\PYG{l+lScalar+lScalarPlain}{github.event.issue.number}\PYG{l+lScalar+lScalarPlain}{ }\PYG{l+lScalar+lScalarPlain}{\PYGZcb{}\PYGZcb{}}
\PYG{+w}{    }\PYG{p+pIndicator}{\PYGZhy{}}\PYG{+w}{ }\PYG{n+nt}{uses}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{actions/upload\PYGZhy{}artifact@v3}
\PYG{+w}{      }\PYG{n+nt}{with}\PYG{p}{:}
\PYG{+w}{          }\PYG{n+nt}{name}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{id}
\PYG{+w}{          }\PYG{n+nt}{path}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{id/}
\PYG{+w}{    }\PYG{p+pIndicator}{\PYGZhy{}}\PYG{+w}{ }\PYG{n+nt}{uses}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{actions/setup\PYGZhy{}python@v4}
\PYG{+w}{      }\PYG{n+nt}{with}\PYG{p}{:}
\PYG{+w}{        }\PYG{n+nt}{python\PYGZhy{}version}\PYG{p}{:}\PYG{+w}{ }\PYG{l+s}{\PYGZsq{}}\PYG{l+s}{3.x}\PYG{l+s}{\PYGZsq{}}\PYG{+w}{ }\PYG{c+c1}{\PYGZsh{} Version range or exact version of a Python version to use, using SemVer\PYGZsq{}s version range syntax}
\PYG{+w}{        }\PYG{n+nt}{architecture}\PYG{p}{:}\PYG{+w}{ }\PYG{l+s}{\PYGZsq{}}\PYG{l+s}{x64}\PYG{l+s}{\PYGZsq{}}\PYG{+w}{ }\PYG{c+c1}{\PYGZsh{} optional x64 or x86. Defaults to x64 if not specified}
\PYG{+w}{    }\PYG{p+pIndicator}{\PYGZhy{}}\PYG{+w}{ }\PYG{n+nt}{run}\PYG{p}{:}\PYG{+w}{ }\PYG{p+pIndicator}{|}
\PYG{+w}{        }\PYG{n+no}{python verify.py \PYGZdl{}BODY}
\PYG{+w}{        }\PYG{n+no}{git clone \PYGZhy{}b store https://github.com/xqy2006/music\PYGZus{}generation.git \PYGZdq{}result\PYGZdq{}}
\PYG{+w}{        }\PYG{n+no}{pip install paddlepaddle}
\PYG{+w}{        }\PYG{n+no}{pip install music21}
\PYG{+w}{        }\PYG{n+no}{pip install protobuf==3.20.0}
\PYG{+w}{        }\PYG{n+no}{python music.py \PYGZdl{}BODY \PYGZdl{}ID}
\PYG{+w}{      }\PYG{n+nt}{env}\PYG{p}{:}
\PYG{+w}{          }\PYG{n+nt}{BODY}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{\PYGZdl{}\PYGZob{}\PYGZob{}}\PYG{l+lScalar+lScalarPlain}{ }\PYG{l+lScalar+lScalarPlain}{github.event.issue.body}\PYG{l+lScalar+lScalarPlain}{ }\PYG{l+lScalar+lScalarPlain}{\PYGZcb{}\PYGZcb{}}
\PYG{+w}{          }\PYG{n+nt}{ID}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{\PYGZdl{}\PYGZob{}\PYGZob{}}\PYG{l+lScalar+lScalarPlain}{ }\PYG{l+lScalar+lScalarPlain}{github.event.issue.number}\PYG{l+lScalar+lScalarPlain}{ }\PYG{l+lScalar+lScalarPlain}{\PYGZcb{}\PYGZcb{}}
\PYG{+w}{    }\PYG{p+pIndicator}{\PYGZhy{}}\PYG{+w}{ }\PYG{n+nt}{uses}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{JamesIves/github\PYGZhy{}pages\PYGZhy{}deploy\PYGZhy{}action@v4.3.3}
\PYG{+w}{      }\PYG{n+nt}{with}\PYG{p}{:}
\PYG{+w}{        }\PYG{n+nt}{branch}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{store}
\PYG{+w}{        }\PYG{n+nt}{folder}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{result}
\PYG{+w}{    }\PYG{p+pIndicator}{\PYGZhy{}}\PYG{+w}{ }\PYG{n+nt}{uses}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{rishabhgupta/split\PYGZhy{}by@v1}
\PYG{+w}{      }\PYG{n+nt}{id}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{split}
\PYG{+w}{      }\PYG{n+nt}{with}\PYG{p}{:}
\PYG{+w}{        }\PYG{n+nt}{string}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{\PYGZdl{}\PYGZob{}\PYGZob{}}\PYG{l+lScalar+lScalarPlain}{ }\PYG{l+lScalar+lScalarPlain}{github.event.issue.body}\PYG{l+lScalar+lScalarPlain}{ }\PYG{l+lScalar+lScalarPlain}{\PYGZcb{}\PYGZcb{}}
\PYG{+w}{        }\PYG{n+nt}{split\PYGZhy{}by}\PYG{p}{:}\PYG{+w}{ }\PYG{l+s}{\PYGZdq{}}\PYG{l+s}{歌词}\PYG{n+nv}{ }\PYG{l+s}{\PYGZbs{}n}\PYG{n+nv}{ }\PYG{l+s}{\PYGZdq{}}
\PYG{+w}{    }\PYG{p+pIndicator}{\PYGZhy{}}\PYG{+w}{ }\PYG{n+nt}{uses}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{mad9000/actions\PYGZhy{}find\PYGZhy{}and\PYGZhy{}replace\PYGZhy{}string@2}
\PYG{+w}{      }\PYG{n+nt}{id}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{findandreplace}
\PYG{+w}{      }\PYG{n+nt}{with}\PYG{p}{:}
\PYG{+w}{        }\PYG{n+nt}{source}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{\PYGZdl{}\PYGZob{}\PYGZob{}}\PYG{l+lScalar+lScalarPlain}{ }\PYG{l+lScalar+lScalarPlain}{steps.split.outputs.\PYGZus{}1\PYGZcb{}\PYGZcb{}}\PYG{+w}{ }\PYG{c+c1}{\PYGZsh{} this translates to ref/heads/main on the main branch, but can be any arbitrary string }
\PYG{+w}{        }\PYG{n+nt}{find}\PYG{p}{:}\PYG{+w}{ }\PYG{l+s}{\PYGZdq{}}\PYG{l+s}{\PYGZbs{}n}\PYG{l+s}{\PYGZdq{}}\PYG{+w}{        }\PYG{c+c1}{\PYGZsh{} we want to remove ref/heads/ from source }
\PYG{+w}{        }\PYG{n+nt}{replace}\PYG{p}{:}\PYG{+w}{ }\PYG{l+s}{\PYGZsq{}}\PYG{l+s}{\PYGZsq{}}\PYG{+w}{               }\PYG{c+c1}{\PYGZsh{} and replace it with a blank string (ie. removing it)}
\PYG{+w}{    }\PYG{p+pIndicator}{\PYGZhy{}}\PYG{+w}{ }\PYG{n+nt}{run}\PYG{p}{:}\PYG{+w}{ }\PYG{p+pIndicator}{|}
\PYG{+w}{        }\PYG{n+no}{python sleep.py \PYGZdl{}ID}
\PYG{+w}{        }\PYG{n+no}{echo OK!}
\PYG{+w}{      }\PYG{n+nt}{env}\PYG{p}{:}
\PYG{+w}{        }\PYG{n+nt}{ID}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{\PYGZdl{}\PYGZob{}\PYGZob{}}\PYG{l+lScalar+lScalarPlain}{ }\PYG{l+lScalar+lScalarPlain}{github.event.issue.number}\PYG{l+lScalar+lScalarPlain}{ }\PYG{l+lScalar+lScalarPlain}{\PYGZcb{}\PYGZcb{}}
\PYG{+w}{    }\PYG{p+pIndicator}{\PYGZhy{}}\PYG{+w}{ }\PYG{n+nt}{name}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{Create}\PYG{l+lScalar+lScalarPlain}{ }\PYG{l+lScalar+lScalarPlain}{comment}
\PYG{+w}{      }\PYG{n+nt}{uses}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{actions\PYGZhy{}cool/issues\PYGZhy{}helper@v2}
\PYG{+w}{      }\PYG{n+nt}{with}\PYG{p}{:}
\PYG{+w}{          }\PYG{n+nt}{actions}\PYG{p}{:}\PYG{+w}{ }\PYG{l+s}{\PYGZsq{}}\PYG{l+s}{create\PYGZhy{}comment}\PYG{l+s}{\PYGZsq{}}
\PYG{+w}{          }\PYG{n+nt}{token}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{\PYGZdl{}\PYGZob{}\PYGZob{}}\PYG{l+lScalar+lScalarPlain}{ }\PYG{l+lScalar+lScalarPlain}{secrets.GITHUB\PYGZus{}TOKEN}\PYG{l+lScalar+lScalarPlain}{ }\PYG{l+lScalar+lScalarPlain}{\PYGZcb{}\PYGZcb{}}
\PYG{+w}{          }\PYG{n+nt}{issue\PYGZhy{}number}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{\PYGZdl{}\PYGZob{}\PYGZob{}}\PYG{l+lScalar+lScalarPlain}{ }\PYG{l+lScalar+lScalarPlain}{github.event.issue.number}\PYG{l+lScalar+lScalarPlain}{ }\PYG{l+lScalar+lScalarPlain}{\PYGZcb{}\PYGZcb{}}
\PYG{+w}{          }\PYG{n+nt}{body}\PYG{p}{:}\PYG{+w}{ }\PYG{p+pIndicator}{|}
\PYG{+w}{            }\PYG{n+no}{你好 \PYGZdl{}\PYGZob{}\PYGZob{} github.event.issue.user.login \PYGZcb{}\PYGZcb{} ，生成结果如下：}
\PYG{+w}{            }\PYG{n+no}{midi格式下载地址为（导入到曲谱软件中无歌词，可在电脑上直接播放）：https://xqy2006.github.io/music\PYGZus{}generation/\PYGZdl{}\PYGZob{}\PYGZob{} github.event.issue.number \PYGZcb{}\PYGZcb{}.midi}
\PYG{+w}{            }\PYG{n+no}{xml格式下载地址为（导入到曲谱软件中有歌词，不可在电脑上直接播放）：https://xqy2006.github.io/music\PYGZus{}generation/\PYGZdl{}\PYGZob{}\PYGZob{} github.event.issue.number \PYGZcb{}\PYGZcb{}.xml}
\PYG{+w}{    }\PYG{p+pIndicator}{\PYGZhy{}}\PYG{+w}{ }\PYG{n+nt}{name}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{Close}\PYG{l+lScalar+lScalarPlain}{ }\PYG{l+lScalar+lScalarPlain}{issue}
\PYG{+w}{      }\PYG{n+nt}{uses}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{actions\PYGZhy{}cool/issues\PYGZhy{}helper@v2}
\PYG{+w}{      }\PYG{n+nt}{with}\PYG{p}{:}
\PYG{+w}{          }\PYG{n+nt}{actions}\PYG{p}{:}\PYG{+w}{ }\PYG{l+s}{\PYGZsq{}}\PYG{l+s}{close\PYGZhy{}issue}\PYG{l+s}{\PYGZsq{}}
\PYG{+w}{          }\PYG{n+nt}{token}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{\PYGZdl{}\PYGZob{}\PYGZob{}}\PYG{l+lScalar+lScalarPlain}{ }\PYG{l+lScalar+lScalarPlain}{secrets.GITHUB\PYGZus{}TOKEN}\PYG{l+lScalar+lScalarPlain}{ }\PYG{l+lScalar+lScalarPlain}{\PYGZcb{}\PYGZcb{}}
\PYG{+w}{          }\PYG{n+nt}{issue\PYGZhy{}number}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{\PYGZdl{}\PYGZob{}\PYGZob{}}\PYG{l+lScalar+lScalarPlain}{ }\PYG{l+lScalar+lScalarPlain}{github.event.issue.number}\PYG{l+lScalar+lScalarPlain}{ }\PYG{l+lScalar+lScalarPlain}{\PYGZcb{}\PYGZcb{}}
\end{sphinxVerbatim}

\sphinxAtStartPar
music\_generation/.github/workflows/verify.yml——当music.yml报错后运行（由verify.py抛出），回复并关闭issue

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n+nt}{name}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{verify}
\PYG{n+nt}{on}\PYG{p}{:}
\PYG{+w}{  }\PYG{n+nt}{workflow\PYGZus{}run}\PYG{p}{:}
\PYG{+w}{    }\PYG{n+nt}{workflows}\PYG{p}{:}\PYG{+w}{ }\PYG{p+pIndicator}{[}\PYG{n+nv}{music}\PYG{p+pIndicator}{]}
\PYG{+w}{    }\PYG{n+nt}{types}\PYG{p}{:}\PYG{+w}{ }\PYG{p+pIndicator}{[}\PYG{n+nv}{completed}\PYG{p+pIndicator}{]}
\PYG{n+nt}{jobs}\PYG{p}{:}
\PYG{+w}{  }\PYG{n+nt}{on\PYGZhy{}failure}\PYG{p}{:}
\PYG{+w}{    }\PYG{n+nt}{runs\PYGZhy{}on}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{ubuntu\PYGZhy{}latest}
\PYG{+w}{    }\PYG{n+nt}{if}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{\PYGZdl{}\PYGZob{}\PYGZob{}}\PYG{l+lScalar+lScalarPlain}{ }\PYG{l+lScalar+lScalarPlain}{github.event.workflow\PYGZus{}run.conclusion}\PYG{l+lScalar+lScalarPlain}{ }\PYG{l+lScalar+lScalarPlain}{==}\PYG{l+lScalar+lScalarPlain}{ }\PYG{l+lScalar+lScalarPlain}{\PYGZsq{}failure\PYGZsq{}}\PYG{l+lScalar+lScalarPlain}{ }\PYG{l+lScalar+lScalarPlain}{\PYGZcb{}\PYGZcb{}}
\PYG{+w}{    }\PYG{n+nt}{steps}\PYG{p}{:}
\PYG{+w}{      }\PYG{p+pIndicator}{\PYGZhy{}}\PYG{+w}{ }\PYG{n+nt}{name}\PYG{p}{:}\PYG{+w}{ }\PYG{l+s}{\PYGZsq{}}\PYG{l+s}{Download}\PYG{n+nv}{ }\PYG{l+s}{artifact}\PYG{l+s}{\PYGZsq{}}
\PYG{+w}{        }\PYG{n+nt}{uses}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{actions/github\PYGZhy{}script@v6}
\PYG{+w}{        }\PYG{n+nt}{with}\PYG{p}{:}
\PYG{+w}{          }\PYG{n+nt}{script}\PYG{p}{:}\PYG{+w}{ }\PYG{p+pIndicator}{|}
\PYG{+w}{            }\PYG{n+no}{let allArtifacts = await github.rest.actions.listWorkflowRunArtifacts(\PYGZob{}}
\PYG{+w}{               }\PYG{n+no}{owner: context.repo.owner,}
\PYG{+w}{               }\PYG{n+no}{repo: context.repo.repo,}
\PYG{+w}{               }\PYG{n+no}{run\PYGZus{}id: context.payload.workflow\PYGZus{}run.id,}
\PYG{+w}{            }\PYG{n+no}{\PYGZcb{});}
\PYG{+w}{            }\PYG{n+no}{let matchArtifact = allArtifacts.data.artifacts.filter((artifact) =\PYGZgt{} \PYGZob{}}
\PYG{+w}{              }\PYG{n+no}{return artifact.name == \PYGZdq{}id\PYGZdq{}}
\PYG{+w}{            }\PYG{n+no}{\PYGZcb{})[0];}
\PYG{+w}{            }\PYG{n+no}{let download = await github.rest.actions.downloadArtifact(\PYGZob{}}
\PYG{+w}{               }\PYG{n+no}{owner: context.repo.owner,}
\PYG{+w}{               }\PYG{n+no}{repo: context.repo.repo,}
\PYG{+w}{               }\PYG{n+no}{artifact\PYGZus{}id: matchArtifact.id,}
\PYG{+w}{               }\PYG{n+no}{archive\PYGZus{}format: \PYGZsq{}zip\PYGZsq{},}
\PYG{+w}{            }\PYG{n+no}{\PYGZcb{});}
\PYG{+w}{            }\PYG{n+no}{let fs = require(\PYGZsq{}fs\PYGZsq{});}
\PYG{+w}{            }\PYG{n+no}{fs.writeFileSync(`\PYGZdl{}\PYGZob{}process.env.GITHUB\PYGZus{}WORKSPACE\PYGZcb{}/id.zip`, Buffer.from(download.data));}

\PYG{+w}{      }\PYG{p+pIndicator}{\PYGZhy{}}\PYG{+w}{ }\PYG{n+nt}{name}\PYG{p}{:}\PYG{+w}{ }\PYG{l+s}{\PYGZsq{}}\PYG{l+s}{Unzip}\PYG{n+nv}{ }\PYG{l+s}{artifact}\PYG{l+s}{\PYGZsq{}}
\PYG{+w}{        }\PYG{n+nt}{run}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{unzip}\PYG{l+lScalar+lScalarPlain}{ }\PYG{l+lScalar+lScalarPlain}{id.zip}

\PYG{+w}{      }\PYG{p+pIndicator}{\PYGZhy{}}\PYG{+w}{ }\PYG{n+nt}{name}\PYG{p}{:}\PYG{+w}{ }\PYG{l+s}{\PYGZsq{}}\PYG{l+s}{Comment}\PYG{n+nv}{ }\PYG{l+s}{on}\PYG{n+nv}{ }\PYG{l+s}{issue}\PYG{l+s}{\PYGZsq{}}
\PYG{+w}{        }\PYG{n+nt}{uses}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{actions/github\PYGZhy{}script@v6}
\PYG{+w}{        }\PYG{n+nt}{with}\PYG{p}{:}
\PYG{+w}{          }\PYG{n+nt}{github\PYGZhy{}token}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{\PYGZdl{}\PYGZob{}\PYGZob{}}\PYG{l+lScalar+lScalarPlain}{ }\PYG{l+lScalar+lScalarPlain}{secrets.GITHUB\PYGZus{}TOKEN}\PYG{l+lScalar+lScalarPlain}{ }\PYG{l+lScalar+lScalarPlain}{\PYGZcb{}\PYGZcb{}}
\PYG{+w}{          }\PYG{n+nt}{script}\PYG{p}{:}\PYG{+w}{ }\PYG{p+pIndicator}{|}
\PYG{+w}{            }\PYG{n+no}{let fs = require(\PYGZsq{}fs\PYGZsq{});}
\PYG{+w}{            }\PYG{n+no}{let issue\PYGZus{}number = Number(fs.readFileSync(\PYGZsq{}./id\PYGZsq{}));}
\PYG{+w}{            }\PYG{n+no}{await github.rest.issues.createComment(\PYGZob{}}
\PYG{+w}{              }\PYG{n+no}{owner: context.repo.owner,}
\PYG{+w}{              }\PYG{n+no}{repo: context.repo.repo,}
\PYG{+w}{              }\PYG{n+no}{issue\PYGZus{}number: issue\PYGZus{}number,}
\PYG{+w}{              }\PYG{n+no}{body:\PYGZdq{}\PYGZsh{} 您的输入有误！\PYGZbs{}n请检查您的输入是否全部为中文字符，并且没有标点\PYGZbs{}n可以通过 https://xqy2006.github.io/Chinese\PYGZhy{}character/ 去除非中文字符\PYGZdq{},}
\PYG{+w}{                      }\PYG{n+no}{\PYGZcb{});}
\PYG{+w}{            }\PYG{n+no}{await github.rest.issues.update(\PYGZob{}}
\PYG{+w}{            }\PYG{n+no}{owner: context.repo.owner,}
\PYG{+w}{            }\PYG{n+no}{repo: context.repo.repo,}
\PYG{+w}{            }\PYG{n+no}{issue\PYGZus{}number: issue\PYGZus{}number,}
\PYG{+w}{            }\PYG{n+no}{state: \PYGZsq{}closed\PYGZsq{},}
\PYG{+w}{            }\PYG{n+no}{\PYGZcb{});}
\end{sphinxVerbatim}

\sphinxAtStartPar
Seq2Seq.py——推理所需

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{paddle}
\PYG{k+kn}{import} \PYG{n+nn}{paddle}\PYG{n+nn}{.}\PYG{n+nn}{nn} \PYG{k}{as} \PYG{n+nn}{nn}

\PYG{c+c1}{\PYGZsh{} 继承paddle.nn.Layer类}
\PYG{k}{class} \PYG{n+nc}{Midi\PYGZus{}Model}\PYG{p}{(}\PYG{n}{nn}\PYG{o}{.}\PYG{n}{Layer}\PYG{p}{)}\PYG{p}{:}
    \PYG{c+c1}{\PYGZsh{} 重写初始化函数}
    \PYG{c+c1}{\PYGZsh{} 参数：字符表长度、嵌入层大小、隐藏层大小、解码器层数、处理数字的最大位数}
    \PYG{k}{def} \PYG{n+nf+fm}{\PYGZus{}\PYGZus{}init\PYGZus{}\PYGZus{}}\PYG{p}{(}\PYG{n+nb+bp}{self}\PYG{p}{,} \PYG{n}{char\PYGZus{}len}\PYG{p}{,} \PYG{n}{embedding\PYGZus{}size}\PYG{o}{=}\PYG{l+m+mi}{128}\PYG{p}{,} \PYG{n}{hidden\PYGZus{}size}\PYG{o}{=}\PYG{l+m+mi}{128}\PYG{p}{,} \PYG{n}{num\PYGZus{}layers}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n}{batch\PYGZus{}size}\PYG{o}{=}\PYG{l+m+mi}{20}\PYG{p}{)}\PYG{p}{:}
        \PYG{n+nb}{super}\PYG{p}{(}\PYG{n}{Midi\PYGZus{}Model}\PYG{p}{,} \PYG{n+nb+bp}{self}\PYG{p}{)}\PYG{o}{.}\PYG{n+nf+fm}{\PYGZus{}\PYGZus{}init\PYGZus{}\PYGZus{}}\PYG{p}{(}\PYG{p}{)}
        \PYG{c+c1}{\PYGZsh{} 初始化变量}
        \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{MAXLEN} \PYG{o}{=} \PYG{l+m+mi}{1}
        \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{batch\PYGZus{}size} \PYG{o}{=} \PYG{n}{batch\PYGZus{}size}
        \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{hidden\PYGZus{}size} \PYG{o}{=} \PYG{n}{hidden\PYGZus{}size}
        \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{char\PYGZus{}len} \PYG{o}{=} \PYG{n}{char\PYGZus{}len}
        \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{num\PYGZus{}layers}\PYG{o}{=}\PYG{n}{num\PYGZus{}layers}
        \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{embedding\PYGZus{}size}\PYG{o}{=}\PYG{n}{embedding\PYGZus{}size}

        \PYG{c+c1}{\PYGZsh{} 嵌入层}
        \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{emb} \PYG{o}{=} \PYG{n}{nn}\PYG{o}{.}\PYG{n}{Embedding}\PYG{p}{(}
            \PYG{n}{char\PYGZus{}len}\PYG{p}{,}
            \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{embedding\PYGZus{}size}
        \PYG{p}{)}

        \PYG{c+c1}{\PYGZsh{} 编码器}
        \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{encoder} \PYG{o}{=} \PYG{n}{nn}\PYG{o}{.}\PYG{n}{LSTM}\PYG{p}{(}
            \PYG{n}{input\PYGZus{}size}\PYG{o}{=}\PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{embedding\PYGZus{}size}\PYG{p}{,}
            \PYG{n}{hidden\PYGZus{}size}\PYG{o}{=}\PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{hidden\PYGZus{}size}\PYG{p}{,}
            \PYG{n}{num\PYGZus{}layers}\PYG{o}{=}\PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{num\PYGZus{}layers}
        \PYG{p}{)}

        \PYG{c+c1}{\PYGZsh{} 解码器}
        \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{decoder} \PYG{o}{=} \PYG{n}{nn}\PYG{o}{.}\PYG{n}{LSTM}\PYG{p}{(}
            \PYG{n}{input\PYGZus{}size}\PYG{o}{=}\PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{hidden\PYGZus{}size}\PYG{p}{,}
            \PYG{n}{hidden\PYGZus{}size}\PYG{o}{=}\PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{hidden\PYGZus{}size}\PYG{p}{,}
            \PYG{n}{num\PYGZus{}layers}\PYG{o}{=}\PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{num\PYGZus{}layers}
        \PYG{p}{)}

        \PYG{c+c1}{\PYGZsh{} 全连接层}
        \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{fc} \PYG{o}{=} \PYG{n}{nn}\PYG{o}{.}\PYG{n}{Linear}\PYG{p}{(}
            \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{hidden\PYGZus{}size}\PYG{p}{,}
            \PYG{n}{char\PYGZus{}len}
        \PYG{p}{)}

    \PYG{c+c1}{\PYGZsh{} 重写模型前向计算函数}
    \PYG{c+c1}{\PYGZsh{} 参数：输入[None, MAXLEN]、标签[None, DIGITS]}
    \PYG{k}{def} \PYG{n+nf}{forward}\PYG{p}{(}\PYG{n+nb+bp}{self}\PYG{p}{,} \PYG{n}{inputs}\PYG{p}{,} \PYG{n}{labels}\PYG{o}{=}\PYG{k+kc}{None}\PYG{p}{)}\PYG{p}{:}
        \PYG{c+c1}{\PYGZsh{} 嵌入层}
        \PYG{n}{out} \PYG{o}{=} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{emb}\PYG{p}{(}\PYG{n}{inputs}\PYG{p}{)}

        \PYG{c+c1}{\PYGZsh{} 编码器}
        \PYG{n}{out}\PYG{p}{,} \PYG{p}{(}\PYG{n}{\PYGZus{}}\PYG{p}{,} \PYG{n}{\PYGZus{}}\PYG{p}{)} \PYG{o}{=} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{encoder}\PYG{p}{(}\PYG{n}{out}\PYG{p}{)}

        \PYG{c+c1}{\PYGZsh{} 按时间步切分编码器输出}
        \PYG{n}{out} \PYG{o}{=} \PYG{n}{paddle}\PYG{o}{.}\PYG{n}{split}\PYG{p}{(}\PYG{n}{out}\PYG{p}{,} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{MAXLEN}\PYG{p}{,} \PYG{n}{axis}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{)}

        \PYG{c+c1}{\PYGZsh{} 取最后一个时间步的输出并复制batch\PYGZus{}size次}
        \PYG{n}{out} \PYG{o}{=} \PYG{n}{paddle}\PYG{o}{.}\PYG{n}{expand}\PYG{p}{(}\PYG{n}{out}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{n}{out}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{batch\PYGZus{}size}\PYG{p}{,} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{hidden\PYGZus{}size}\PYG{p}{]}\PYG{p}{)}

        \PYG{c+c1}{\PYGZsh{} 解码器}
        \PYG{n}{out}\PYG{p}{,} \PYG{p}{(}\PYG{n}{\PYGZus{}}\PYG{p}{,} \PYG{n}{\PYGZus{}}\PYG{p}{)} \PYG{o}{=} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{decoder}\PYG{p}{(}\PYG{n}{out}\PYG{p}{)}

        \PYG{c+c1}{\PYGZsh{} 全连接}
        \PYG{n}{out} \PYG{o}{=} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{fc}\PYG{p}{(}\PYG{n}{out}\PYG{p}{)}

        \PYG{c+c1}{\PYGZsh{} 如果标签存在，则计算其损失和准确率}
        \PYG{k}{if} \PYG{n}{labels} \PYG{o+ow}{is} \PYG{o+ow}{not} \PYG{k+kc}{None}\PYG{p}{:}
            \PYG{c+c1}{\PYGZsh{} 转置解码器输出}
            \PYG{n}{tmp} \PYG{o}{=} \PYG{n}{paddle}\PYG{o}{.}\PYG{n}{transpose}\PYG{p}{(}\PYG{n}{out}\PYG{p}{,} \PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}

            \PYG{c+c1}{\PYGZsh{} 计算交叉熵损失}
            \PYG{n}{loss} \PYG{o}{=} \PYG{n}{nn}\PYG{o}{.}\PYG{n}{functional}\PYG{o}{.}\PYG{n}{cross\PYGZus{}entropy}\PYG{p}{(}\PYG{n}{tmp}\PYG{p}{,} \PYG{n}{labels}\PYG{p}{,} \PYG{n}{axis}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{)}

            \PYG{c+c1}{\PYGZsh{} 计算准确率}
            \PYG{n}{acc} \PYG{o}{=} \PYG{n}{paddle}\PYG{o}{.}\PYG{n}{metric}\PYG{o}{.}\PYG{n}{accuracy}\PYG{p}{(}\PYG{n}{paddle}\PYG{o}{.}\PYG{n}{reshape}\PYG{p}{(}\PYG{n}{out}\PYG{p}{,} \PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{char\PYGZus{}len}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,} \PYG{n}{paddle}\PYG{o}{.}\PYG{n}{reshape}\PYG{p}{(}\PYG{n}{labels}\PYG{p}{,} \PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}

            \PYG{c+c1}{\PYGZsh{} 返回损失和准确率}
            \PYG{k}{return} \PYG{n}{loss}\PYG{p}{,} \PYG{n}{acc}

        \PYG{c+c1}{\PYGZsh{} 返回输出}
        \PYG{k}{return} \PYG{n}{out}


\PYG{c+c1}{\PYGZsh{} 继承paddle.nn.Layer类}
\PYG{k}{class} \PYG{n+nc}{Duration\PYGZus{}Model}\PYG{p}{(}\PYG{n}{nn}\PYG{o}{.}\PYG{n}{Layer}\PYG{p}{)}\PYG{p}{:}
    \PYG{c+c1}{\PYGZsh{} 重写初始化函数}
    \PYG{c+c1}{\PYGZsh{} 参数：字符表长度、嵌入层大小、隐藏层大小、解码器层数、处理数字的最大位数}
    \PYG{k}{def} \PYG{n+nf+fm}{\PYGZus{}\PYGZus{}init\PYGZus{}\PYGZus{}}\PYG{p}{(}\PYG{n+nb+bp}{self}\PYG{p}{,} \PYG{n}{char\PYGZus{}len}\PYG{p}{,} \PYG{n}{embedding\PYGZus{}size}\PYG{o}{=}\PYG{l+m+mi}{128}\PYG{p}{,} \PYG{n}{hidden\PYGZus{}size}\PYG{o}{=}\PYG{l+m+mi}{64}\PYG{p}{,} \PYG{n}{num\PYGZus{}layers}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n}{batch\PYGZus{}size}\PYG{o}{=}\PYG{l+m+mi}{20}\PYG{p}{)}\PYG{p}{:}
        \PYG{n+nb}{super}\PYG{p}{(}\PYG{n}{Duration\PYGZus{}Model}\PYG{p}{,} \PYG{n+nb+bp}{self}\PYG{p}{)}\PYG{o}{.}\PYG{n+nf+fm}{\PYGZus{}\PYGZus{}init\PYGZus{}\PYGZus{}}\PYG{p}{(}\PYG{p}{)}
        \PYG{c+c1}{\PYGZsh{} 初始化变量}
        \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{batch\PYGZus{}size} \PYG{o}{=} \PYG{n}{batch\PYGZus{}size}
        \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{MAXLEN} \PYG{o}{=} \PYG{l+m+mi}{1}
        \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{hidden\PYGZus{}size} \PYG{o}{=} \PYG{n}{hidden\PYGZus{}size}
        \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{char\PYGZus{}len} \PYG{o}{=} \PYG{n}{char\PYGZus{}len}
        \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{num\PYGZus{}layers}\PYG{o}{=}\PYG{n}{num\PYGZus{}layers}
        \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{embedding\PYGZus{}size}\PYG{o}{=}\PYG{n}{embedding\PYGZus{}size}

        \PYG{c+c1}{\PYGZsh{} 嵌入层}
        \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{emb} \PYG{o}{=} \PYG{n}{nn}\PYG{o}{.}\PYG{n}{Embedding}\PYG{p}{(}
            \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{char\PYGZus{}len}\PYG{p}{,}
            \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{embedding\PYGZus{}size}
        \PYG{p}{)}

        \PYG{c+c1}{\PYGZsh{} 编码器}
        \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{encoder} \PYG{o}{=} \PYG{n}{nn}\PYG{o}{.}\PYG{n}{LSTM}\PYG{p}{(}
            \PYG{n}{input\PYGZus{}size}\PYG{o}{=}\PYG{n}{embedding\PYGZus{}size}\PYG{p}{,}
            \PYG{n}{hidden\PYGZus{}size}\PYG{o}{=}\PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{hidden\PYGZus{}size}\PYG{p}{,}
            \PYG{n}{num\PYGZus{}layers}\PYG{o}{=}\PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{num\PYGZus{}layers}
        \PYG{p}{)}

        \PYG{c+c1}{\PYGZsh{} 解码器}
        \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{decoder} \PYG{o}{=} \PYG{n}{nn}\PYG{o}{.}\PYG{n}{LSTM}\PYG{p}{(}
            \PYG{n}{input\PYGZus{}size}\PYG{o}{=}\PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{hidden\PYGZus{}size}\PYG{p}{,}
            \PYG{n}{hidden\PYGZus{}size}\PYG{o}{=}\PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{hidden\PYGZus{}size}\PYG{p}{,}
            \PYG{n}{num\PYGZus{}layers}\PYG{o}{=}\PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{num\PYGZus{}layers}
        \PYG{p}{)}

        \PYG{c+c1}{\PYGZsh{} 全连接层}
        \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{fc} \PYG{o}{=} \PYG{n}{nn}\PYG{o}{.}\PYG{n}{Linear}\PYG{p}{(}
            \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{hidden\PYGZus{}size}\PYG{p}{,}
            \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{char\PYGZus{}len}
        \PYG{p}{)}

    \PYG{c+c1}{\PYGZsh{} 重写模型前向计算函数}
    \PYG{c+c1}{\PYGZsh{} 参数：输入[None, MAXLEN]、标签[None, DIGITS]}
    \PYG{k}{def} \PYG{n+nf}{forward}\PYG{p}{(}\PYG{n+nb+bp}{self}\PYG{p}{,} \PYG{n}{inputs}\PYG{p}{,} \PYG{n}{labels}\PYG{o}{=}\PYG{k+kc}{None}\PYG{p}{)}\PYG{p}{:}
        \PYG{c+c1}{\PYGZsh{} 嵌入层}
        \PYG{n}{out} \PYG{o}{=} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{emb}\PYG{p}{(}\PYG{n}{inputs}\PYG{p}{)}

        \PYG{c+c1}{\PYGZsh{} 编码器}
        \PYG{n}{out}\PYG{p}{,} \PYG{p}{(}\PYG{n}{\PYGZus{}}\PYG{p}{,} \PYG{n}{\PYGZus{}}\PYG{p}{)} \PYG{o}{=} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{encoder}\PYG{p}{(}\PYG{n}{out}\PYG{p}{)}

        \PYG{c+c1}{\PYGZsh{} 按时间步切分编码器输出}
        \PYG{n}{out} \PYG{o}{=} \PYG{n}{paddle}\PYG{o}{.}\PYG{n}{split}\PYG{p}{(}\PYG{n}{out}\PYG{p}{,} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{MAXLEN}\PYG{p}{,} \PYG{n}{axis}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{)}

        \PYG{c+c1}{\PYGZsh{} 取最后一个时间步的输出并复制batch\PYGZus{}size次}
        \PYG{n}{out} \PYG{o}{=} \PYG{n}{paddle}\PYG{o}{.}\PYG{n}{expand}\PYG{p}{(}\PYG{n}{out}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{n}{out}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{batch\PYGZus{}size}\PYG{p}{,} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{hidden\PYGZus{}size}\PYG{p}{]}\PYG{p}{)}

        \PYG{c+c1}{\PYGZsh{} 解码器}
        \PYG{n}{out}\PYG{p}{,} \PYG{p}{(}\PYG{n}{\PYGZus{}}\PYG{p}{,} \PYG{n}{\PYGZus{}}\PYG{p}{)} \PYG{o}{=} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{decoder}\PYG{p}{(}\PYG{n}{out}\PYG{p}{)}

        \PYG{c+c1}{\PYGZsh{} 全连接}
        \PYG{n}{out} \PYG{o}{=} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{fc}\PYG{p}{(}\PYG{n}{out}\PYG{p}{)}

        \PYG{c+c1}{\PYGZsh{} 如果标签存在，则计算其损失和准确率}
        \PYG{k}{if} \PYG{n}{labels} \PYG{o+ow}{is} \PYG{o+ow}{not} \PYG{k+kc}{None}\PYG{p}{:}
            \PYG{c+c1}{\PYGZsh{} 转置解码器输出}
            \PYG{n}{tmp} \PYG{o}{=} \PYG{n}{paddle}\PYG{o}{.}\PYG{n}{transpose}\PYG{p}{(}\PYG{n}{out}\PYG{p}{,} \PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}

            \PYG{c+c1}{\PYGZsh{} 计算交叉熵损失}
            \PYG{n}{loss} \PYG{o}{=} \PYG{n}{nn}\PYG{o}{.}\PYG{n}{functional}\PYG{o}{.}\PYG{n}{cross\PYGZus{}entropy}\PYG{p}{(}\PYG{n}{tmp}\PYG{p}{,} \PYG{n}{labels}\PYG{p}{,} \PYG{n}{axis}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{)}

            \PYG{c+c1}{\PYGZsh{} 计算准确率}
            \PYG{n}{acc} \PYG{o}{=} \PYG{n}{paddle}\PYG{o}{.}\PYG{n}{metric}\PYG{o}{.}\PYG{n}{accuracy}\PYG{p}{(}\PYG{n}{paddle}\PYG{o}{.}\PYG{n}{reshape}\PYG{p}{(}\PYG{n}{out}\PYG{p}{,} \PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{char\PYGZus{}len}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,} \PYG{n}{paddle}\PYG{o}{.}\PYG{n}{reshape}\PYG{p}{(}\PYG{n}{labels}\PYG{p}{,} \PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}

            \PYG{c+c1}{\PYGZsh{} 返回损失和准确率}
            \PYG{k}{return} \PYG{n}{loss}\PYG{p}{,} \PYG{n}{acc}

        \PYG{c+c1}{\PYGZsh{} 返回输出}
        \PYG{k}{return} \PYG{n}{out}
\end{sphinxVerbatim}

\sphinxAtStartPar
Reader.py——推理所需

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{music21} \PYG{k+kn}{import} \PYG{n}{note}\PYG{p}{,}\PYG{n}{converter}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{k+kn}{import} \PYG{n+nn}{os}
\PYG{k+kn}{import} \PYG{n+nn}{json}
\PYG{k+kn}{import} \PYG{n+nn}{fractions}

\PYG{k}{def} \PYG{n+nf}{Reader}\PYG{p}{(}\PYG{n}{DIGITS}\PYG{p}{,}\PYG{n}{path} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{./work/data}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{dur\PYGZus{}dic} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{p}{\PYGZcb{}}
    \PYG{k}{def} \PYG{n+nf}{read\PYGZus{}data}\PYG{p}{(}\PYG{p}{)}\PYG{p}{:}
        \PYG{k}{for} \PYG{n}{file} \PYG{o+ow}{in} \PYG{n}{os}\PYG{o}{.}\PYG{n}{listdir}\PYG{p}{(}\PYG{n}{path}\PYG{p}{)}\PYG{p}{:}
            \PYG{n}{lyrics} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
            \PYG{n}{midis} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
            \PYG{n}{durations} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
            \PYG{n}{xml} \PYG{o}{=} \PYG{n}{converter}\PYG{o}{.}\PYG{n}{parseFile}\PYG{p}{(}\PYG{n}{os}\PYG{o}{.}\PYG{n}{path}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{path}\PYG{p}{,}\PYG{n}{file}\PYG{p}{)}\PYG{p}{)}
            \PYG{c+c1}{\PYGZsh{}print(dir(stream.Score()))}
            \PYG{k}{for} \PYG{n}{i}\PYG{p}{,} \PYG{n}{note} \PYG{o+ow}{in} \PYG{n+nb}{enumerate}\PYG{p}{(}\PYG{n}{xml}\PYG{o}{.}\PYG{n}{recurse}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{notesAndRests}\PYG{p}{)}\PYG{p}{:}
                \PYG{k}{if} \PYG{n}{i}\PYG{o}{\PYGZpc{}}\PYG{n}{DIGITS} \PYG{o}{==} \PYG{l+m+mi}{0}\PYG{p}{:}
                    \PYG{n}{lyrics}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{p}{[}\PYG{p}{]}\PYG{p}{)}
                    \PYG{n}{midis}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{p}{[}\PYG{p}{]}\PYG{p}{)}
                    \PYG{n}{durations}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{p}{[}\PYG{p}{]}\PYG{p}{)}
                \PYG{n}{lyric} \PYG{o}{=} \PYG{n}{note}\PYG{o}{.}\PYG{n}{\PYGZus{}getLyric}\PYG{p}{(}\PYG{p}{)}
                \PYG{k}{if} \PYG{n}{lyric} \PYG{o}{==} \PYG{k+kc}{None}\PYG{p}{:}
                    \PYG{n}{lyric} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}}\PYG{l+s+s1}{\PYGZsq{}}
                \PYG{n}{lyrics}\PYG{p}{[}\PYG{n}{i}\PYG{o}{/}\PYG{o}{/}\PYG{n}{DIGITS}\PYG{p}{]}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n+nb}{ord}\PYG{p}{(}\PYG{n}{lyric}\PYG{p}{)}\PYG{p}{)}
                \PYG{k}{try}\PYG{p}{:}
                    \PYG{n}{midis}\PYG{p}{[}\PYG{n}{i}\PYG{o}{/}\PYG{o}{/}\PYG{n}{DIGITS}\PYG{p}{]}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{note}\PYG{o}{.}\PYG{n}{pitch}\PYG{o}{.}\PYG{n}{midi}\PYG{p}{)}
                \PYG{k}{except}\PYG{p}{:}
                    \PYG{n}{midis}\PYG{p}{[}\PYG{n}{i}\PYG{o}{/}\PYG{o}{/}\PYG{n}{DIGITS}\PYG{p}{]}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{)}
                \PYG{n}{durations}\PYG{p}{[}\PYG{n}{i}\PYG{o}{/}\PYG{o}{/}\PYG{n}{DIGITS}\PYG{p}{]}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{note}\PYG{o}{.}\PYG{n}{duration}\PYG{o}{.}\PYG{n}{quarterLength}\PYG{p}{)}
                \PYG{k}{if} \PYG{n+nb}{type}\PYG{p}{(}\PYG{n}{note}\PYG{o}{.}\PYG{n}{duration}\PYG{o}{.}\PYG{n}{quarterLength}\PYG{p}{)} \PYG{o}{==} \PYG{n}{fractions}\PYG{o}{.}\PYG{n}{Fraction} \PYG{o+ow}{and} \PYG{n+nb}{float}\PYG{p}{(}\PYG{n}{note}\PYG{o}{.}\PYG{n}{duration}\PYG{o}{.}\PYG{n}{quarterLength}\PYG{p}{)} \PYG{o+ow}{not} \PYG{o+ow}{in} \PYG{n+nb}{list}\PYG{p}{(}\PYG{n}{dur\PYGZus{}dic}\PYG{o}{.}\PYG{n}{values}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}\PYG{p}{:}
                        \PYG{n}{dur\PYGZus{}dic}\PYG{p}{[}\PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{dur\PYGZus{}dic}\PYG{p}{)}\PYG{p}{]} \PYG{o}{=} \PYG{n+nb}{float}\PYG{p}{(}\PYG{n}{note}\PYG{o}{.}\PYG{n}{duration}\PYG{o}{.}\PYG{n}{quarterLength}\PYG{p}{)}
                \PYG{k}{elif} \PYG{n+nb}{type}\PYG{p}{(}\PYG{n}{note}\PYG{o}{.}\PYG{n}{duration}\PYG{o}{.}\PYG{n}{quarterLength}\PYG{p}{)} \PYG{o}{!=} \PYG{n}{fractions}\PYG{o}{.}\PYG{n}{Fraction} \PYG{o+ow}{and} \PYG{n}{note}\PYG{o}{.}\PYG{n}{duration}\PYG{o}{.}\PYG{n}{quarterLength} \PYG{o+ow}{not} \PYG{o+ow}{in} \PYG{n+nb}{list}\PYG{p}{(}\PYG{n}{dur\PYGZus{}dic}\PYG{o}{.}\PYG{n}{values}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}\PYG{p}{:}
                    \PYG{n}{dur\PYGZus{}dic}\PYG{p}{[}\PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{dur\PYGZus{}dic}\PYG{p}{)}\PYG{p}{]} \PYG{o}{=} \PYG{n}{note}\PYG{o}{.}\PYG{n}{duration}\PYG{o}{.}\PYG{n}{quarterLength}
            \PYG{k}{yield} \PYG{p}{[}\PYG{n}{midis}\PYG{p}{,}\PYG{n}{durations}\PYG{p}{,}\PYG{n}{lyrics}\PYG{p}{]}
        \PYG{k}{with} \PYG{n+nb}{open}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{dur\PYGZus{}dic.json}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{w}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)} \PYG{k}{as} \PYG{n}{f}\PYG{p}{:}
            \PYG{n}{f}\PYG{o}{.}\PYG{n}{write}\PYG{p}{(}\PYG{n}{json}\PYG{o}{.}\PYG{n}{dumps}\PYG{p}{(}\PYG{n}{dur\PYGZus{}dic}\PYG{p}{)}\PYG{p}{)}
    \PYG{k}{return} \PYG{n}{read\PYGZus{}data}
\end{sphinxVerbatim}


\paragraph{4. 成果}
\label{\detokenize{qianduanandhouduan/qita/contents:id9}}
\sphinxAtStartPar
https://www.github.com/xqy2006/music\_generation

\sphinxstepscope


\chapter{crack}
\label{\detokenize{crack/index:crack}}\label{\detokenize{crack/index::doc}}

\section{Typora破解(1.3.6)}
\label{\detokenize{crack/index:typora-1-3-6}}



\subsection{1. 抓取解密后js：}
\label{\detokenize{crack/index:js}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{pip} \PYG{n}{install} \PYG{n}{frida}
\PYG{n}{frida} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{D:\PYGZbs{}Program Files\PYGZbs{}Typora\PYGZbs{}Typora.exe}\PYG{l+s+s2}{\PYGZdq{}} \PYG{n}{\PYGZhy{}l} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{./unpack.js}\PYG{l+s+s2}{\PYGZdq{}}
\end{sphinxVerbatim}

\sphinxAtStartPar
unpack.js:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kd}{let}\PYG{+w}{ }\PYG{n+nx}{napi\PYGZus{}create\PYGZus{}string\PYGZus{}utf8}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n+nx}{Module}\PYG{p}{.}\PYG{n+nx}{getExportByName}\PYG{p}{(}\PYG{k+kc}{null}\PYG{p}{,}\PYG{+w}{ }\PYG{l+s+s1}{\PYGZsq{}napi\PYGZus{}create\PYGZus{}string\PYGZus{}utf8\PYGZsq{}}\PYG{p}{)}\PYG{p}{;}
\PYG{k+kd}{var}\PYG{+w}{ }\PYG{n+nx}{index}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mf}{0}\PYG{p}{;}
\PYG{k}{if}\PYG{+w}{ }\PYG{p}{(}\PYG{n+nx}{napi\PYGZus{}create\PYGZus{}string\PYGZus{}utf8}\PYG{p}{)}\PYG{+w}{ }\PYG{p}{\PYGZob{}}
\PYG{+w}{    }\PYG{n+nx}{console}\PYG{p}{.}\PYG{n+nx}{log}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}绑定成功\PYGZsq{}}\PYG{p}{)}\PYG{p}{;}
\PYG{+w}{    }\PYG{n+nx}{Interceptor}\PYG{p}{.}\PYG{n+nx}{attach}\PYG{p}{(}\PYG{n+nx}{napi\PYGZus{}create\PYGZus{}string\PYGZus{}utf8}\PYG{p}{,}\PYG{+w}{ }\PYG{p}{\PYGZob{}}
\PYG{+w}{        }\PYG{n+nx}{onEnter}\PYG{o}{:}\PYG{+w}{ }\PYG{k+kd}{function}\PYG{+w}{ }\PYG{p}{(}\PYG{n+nx}{args}\PYG{p}{)}\PYG{+w}{ }\PYG{p}{\PYGZob{}}
\PYG{+w}{            }\PYG{n+nx}{console}\PYG{p}{.}\PYG{n+nx}{log}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}napi\PYGZus{}create\PYGZus{}string\PYGZus{}utf8\PYGZsq{}}\PYG{p}{,}\PYG{+w}{ }\PYG{l+s+s1}{\PYGZsq{}调用\PYGZsq{}}\PYG{p}{,}\PYG{+w}{ }\PYG{n+nx}{args}\PYG{p}{[}\PYG{l+m+mf}{0}\PYG{p}{]}\PYG{p}{,}\PYG{+w}{ }\PYG{n+nx}{args}\PYG{p}{[}\PYG{l+m+mf}{1}\PYG{p}{]}\PYG{p}{.}\PYG{n+nx}{readCString}\PYG{p}{(}\PYG{p}{)}\PYG{p}{.}\PYG{n+nx}{substring}\PYG{p}{(}\PYG{l+m+mf}{0}\PYG{p}{,}\PYG{+w}{ }\PYG{l+m+mf}{100}\PYG{p}{)}\PYG{p}{,}\PYG{+w}{ }\PYG{n+nx}{args}\PYG{p}{[}\PYG{l+m+mf}{2}\PYG{p}{]}\PYG{p}{,}\PYG{+w}{ }\PYG{n+nx}{args}\PYG{p}{[}\PYG{l+m+mf}{3}\PYG{p}{]}\PYG{p}{)}\PYG{p}{;}
\PYG{+w}{ }
\PYG{+w}{            }\PYG{k}{if}\PYG{+w}{ }\PYG{p}{(}\PYG{n+nx}{args}\PYG{p}{[}\PYG{l+m+mf}{2}\PYG{p}{]}\PYG{p}{.}\PYG{n+nx}{toInt32}\PYG{p}{(}\PYG{p}{)}\PYG{+w}{ }\PYG{o}{\PYGZgt{}}\PYG{+w}{ }\PYG{l+m+mf}{100}\PYG{p}{)}\PYG{+w}{ }\PYG{p}{\PYGZob{}}\PYG{+w}{ }\PYG{c+c1}{// 过滤出大文件}
\PYG{+w}{                }\PYG{n+nx}{index}\PYG{+w}{ }\PYG{o}{+=}\PYG{+w}{ }\PYG{l+m+mf}{1}\PYG{p}{;}
\PYG{+w}{                }\PYG{k+kd}{var}\PYG{+w}{ }\PYG{n+nx}{f}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{o+ow}{new}\PYG{+w}{ }\PYG{n+nx}{File}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}export\PYGZus{}\PYGZsq{}}\PYG{+w}{ }\PYG{o}{+}\PYG{+w}{ }\PYG{n+nb}{String}\PYG{p}{(}\PYG{n+nx}{index}\PYG{p}{)}\PYG{+w}{ }\PYG{o}{+}\PYG{+w}{ }\PYG{l+s+s1}{\PYGZsq{}.js\PYGZsq{}}\PYG{p}{,}\PYG{+w}{ }\PYG{l+s+s1}{\PYGZsq{}wb\PYGZsq{}}\PYG{p}{)}\PYG{p}{;}
\PYG{+w}{                }\PYG{n+nx}{f}\PYG{p}{.}\PYG{n+nx}{write}\PYG{p}{(}\PYG{n+nx}{args}\PYG{p}{[}\PYG{l+m+mf}{1}\PYG{p}{]}\PYG{p}{.}\PYG{n+nx}{readByteArray}\PYG{p}{(}\PYG{n+nx}{args}\PYG{p}{[}\PYG{l+m+mf}{2}\PYG{p}{]}\PYG{p}{.}\PYG{n+nx}{toInt32}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}\PYG{p}{;}
\PYG{+w}{                }\PYG{n+nx}{f}\PYG{p}{.}\PYG{n+nx}{flush}\PYG{p}{(}\PYG{p}{)}\PYG{p}{;}
\PYG{+w}{                }\PYG{n+nx}{f}\PYG{p}{.}\PYG{n+nx}{close}\PYG{p}{(}\PYG{p}{)}\PYG{p}{;}
\PYG{+w}{ }
\PYG{+w}{            }\PYG{p}{\PYGZcb{}}
\PYG{+w}{        }\PYG{p}{\PYGZcb{}}
\PYG{+w}{    }\PYG{p}{\PYGZcb{}}\PYG{p}{)}\PYG{p}{;}
\PYG{p}{\PYGZcb{}}\PYG{+w}{ }\PYG{k}{else}\PYG{+w}{ }\PYG{p}{\PYGZob{}}
\PYG{+w}{    }\PYG{n+nx}{console}\PYG{p}{.}\PYG{n+nx}{log}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}绑定失败\PYGZsq{}}\PYG{p}{)}\PYG{p}{;}
\PYG{p}{\PYGZcb{}}
\end{sphinxVerbatim}


\subsection{2. 将解包出来最大的js重命名为Atom.js，找到以下代码替换RSA Public Key的base64，删除renew：}
\label{\detokenize{crack/index:jsatom-js-rsa-public-keybase64-renew}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n+nx}{T}\PYG{o}{=}\PYG{n+nb}{JSON}\PYG{p}{.}\PYG{n+nx}{parse}\PYG{p}{(}\PYG{n+nx}{Buffer}\PYG{p}{.}\PYG{k+kr}{from}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}WyItLS0tLUJFR0lOIFBVQkxJQyBLRVktLS0tLSIsIk1JSUJJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBUThBTUlJQkNnS0NBUUVBek9KOFBXTkxSbkpST3Y1UzhZcFIiLCJ5TVkrMFQwRlZjY2drMEQ1Z3N6YlE3N01WYzlwd2grYmEvenE4aUV4SjdVZ3dsN2FjNHd5MnAvVkJRMms1ZzJqIiwiZVI5TFRoRG9kNXRzWnhmYmppK0lHTGN1SkJCY3J0d3dDeWl6U1JTVTNFbHVoZm1kck9PRHdEUnQvYWxrdFhDaSIsIlQ5Si9JMG03UGcwdTJvaDFXYjY0WndWSDRsVEpaTFByZk8waXhFRjcrSGl1ZytWWi9oMFRnLzZOTjJNaGZJRFciLCIwQk56cUw5dmFZSXhsdUdSaWM2dE5Ra240SGFWZFFGODF2K1hsL1FjRHc2T05MNkFrUEF2TkI1ZGZENm4zb2IyIiwiZjNNMWlySU9PVlZZb3Z0b0ErMXBOTDJLUEsrNE94M3lSSEZWUmlBNms2NXduNlg3anNWNWpDdWdoQ2dyVVhjRiIsIlV3SURBUUFCIiwiLS0tLS1FTkQgUFVCTElDIEtFWS0tLS0tIiwiIiwiIl0=\PYGZdq{}}\PYG{p}{,}\PYG{l+s+s2}{\PYGZdq{}base64\PYGZdq{}}\PYG{p}{)}\PYG{p}{.}\PYG{n+nx}{toString}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}utf8\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{//删除下面的/api/client/renew}
\PYG{k+kd}{const}\PYG{+w}{ }\PYG{n+nx}{a}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{k}{await}\PYG{+w}{ }\PYG{p}{(}\PYG{k}{await}\PYG{+w}{ }\PYG{n+nx}{k}\PYG{p}{(}\PYG{n+nx}{W}\PYG{+w}{ }\PYG{o}{+}\PYG{+w}{ }\PYG{l+s+s2}{\PYGZdq{}/api/client/renew\PYGZdq{}}\PYG{p}{,}\PYG{+w}{ }\PYG{p}{\PYGZob{}}
\PYG{+w}{	}\PYG{n+nx}{method}\PYG{o}{:}\PYG{+w}{ }\PYG{l+s+s2}{\PYGZdq{}POST\PYGZdq{}}\PYG{p}{,}
\PYG{+w}{	}\PYG{n+nx}{cache}\PYG{o}{:}\PYG{+w}{ }\PYG{l+s+s2}{\PYGZdq{}no\PYGZhy{}cache\PYGZdq{}}\PYG{p}{,}
\PYG{+w}{	}\PYG{n+nx}{body}\PYG{o}{:}\PYG{+w}{ }\PYG{n+nb}{JSON}\PYG{p}{.}\PYG{n+nx}{stringify}\PYG{p}{(}\PYG{n+nx}{n}\PYG{p}{)}\PYG{p}{,}
\PYG{+w}{	}\PYG{n+nx}{headers}\PYG{o}{:}\PYG{+w}{ }\PYG{p}{\PYGZob{}}
\PYG{+w}{		}\PYG{l+s+s2}{\PYGZdq{}Content\PYGZhy{}Type\PYGZdq{}}\PYG{o}{:}\PYG{+w}{ }\PYG{l+s+s2}{\PYGZdq{}application/json\PYGZdq{}}\PYG{p}{,}
\PYG{+w}{		}\PYG{l+s+s2}{\PYGZdq{}Cache\PYGZhy{}Control\PYGZdq{}}\PYG{o}{:}\PYG{+w}{ }\PYG{l+s+s2}{\PYGZdq{}no\PYGZhy{}cache\PYGZdq{}}
\PYG{+w}{		}\PYG{p}{\PYGZcb{}}
\PYG{+w}{	}\PYG{p}{\PYGZcb{}}
\end{sphinxVerbatim}


\subsection{3. 解包app.asar：}
\label{\detokenize{crack/index:app-asar}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{npm} \PYG{n}{install} \PYG{n}{asar} \PYG{n}{\PYGZhy{}g}
\PYG{n+nb}{cd }\PYG{n}{D}\PYG{p}{:}\PYG{p}{\PYGZbs{}}\PYG{n}{Program} \PYG{n}{Files}\PYG{p}{\PYGZbs{}}\PYG{n}{Typora}\PYG{p}{\PYGZbs{}}\PYG{n}{resources}
\PYG{n}{asar} \PYG{n}{extract} \PYG{p}{.}\PYG{p}{/}\PYG{n}{app}\PYG{p}{.}\PYG{n}{asar} \PYG{p}{.}\PYG{p}{/}\PYG{n}{app}
\end{sphinxVerbatim}


\subsection{4. 将刚刚修改好的Atom.js替换“D:\textbackslash{}Program Files\textbackslash{}Typora\textbackslash{}resources\textbackslash{}app\textbackslash{}”下的同名文件}
\label{\detokenize{crack/index:atom-jsd-program-files-typora-resources-app}}

\subsection{5. 删除“D:\textbackslash{}Program Files\textbackslash{}Typora\textbackslash{}resources\textbackslash{}”下的“app.asar”}
\label{\detokenize{crack/index:d-program-files-typora-resources-app-asar}}

\subsection{6. 编写keygen}
\label{\detokenize{crack/index:keygen}}
\sphinxAtStartPar
RSA公私钥生成：

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kd}{const}\PYG{+w}{ }\PYG{n+nx}{crypto}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n+nx}{require}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}crypto\PYGZsq{}}\PYG{p}{)}\PYG{p}{;}
\PYG{k+kd}{const}\PYG{+w}{ }\PYG{n+nx}{fs}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n+nx}{require}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}fs\PYGZsq{}}\PYG{p}{)}\PYG{p}{;}
\PYG{k+kd}{const}\PYG{+w}{ }\PYG{n+nx}{path}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n+nx}{require}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}path\PYGZsq{}}\PYG{p}{)}\PYG{p}{;}
\PYG{+w}{ }
\PYG{k+kd}{const}\PYG{+w}{ }\PYG{n+nx}{keyPair}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n+nx}{crypto}\PYG{p}{.}\PYG{n+nx}{generateKeyPairSync}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}rsa\PYGZsq{}}\PYG{p}{,}\PYG{+w}{ }\PYG{p}{\PYGZob{}}
\PYG{+w}{   }\PYG{n+nx}{modulusLength}\PYG{o}{:}\PYG{+w}{ }\PYG{l+m+mf}{2048}\PYG{p}{,}
\PYG{+w}{   }\PYG{n+nx}{publicKeyEncoding}\PYG{o}{:}\PYG{+w}{ }\PYG{p}{\PYGZob{}}
\PYG{+w}{      }\PYG{n+nx}{type}\PYG{o}{:}\PYG{+w}{ }\PYG{l+s+s1}{\PYGZsq{}spki\PYGZsq{}}\PYG{p}{,}
\PYG{+w}{      }\PYG{n+nx}{format}\PYG{o}{:}\PYG{+w}{ }\PYG{l+s+s1}{\PYGZsq{}pem\PYGZsq{}}
\PYG{+w}{   }\PYG{p}{\PYGZcb{}}\PYG{p}{,}
\PYG{+w}{   }\PYG{n+nx}{privateKeyEncoding}\PYG{o}{:}\PYG{+w}{ }\PYG{p}{\PYGZob{}}
\PYG{+w}{      }\PYG{n+nx}{type}\PYG{o}{:}\PYG{+w}{ }\PYG{l+s+s1}{\PYGZsq{}pkcs8\PYGZsq{}}\PYG{p}{,}
\PYG{+w}{      }\PYG{n+nx}{format}\PYG{o}{:}\PYG{+w}{ }\PYG{l+s+s1}{\PYGZsq{}pem\PYGZsq{}}\PYG{p}{,}
\PYG{+w}{   }\PYG{p}{\PYGZcb{}}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}\PYG{p}{;}
\PYG{+w}{ }
\PYG{n+nx}{fs}\PYG{p}{.}\PYG{n+nx}{writeFileSync}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}public\PYGZus{}key.pem\PYGZdq{}}\PYG{p}{,}\PYG{+w}{ }\PYG{n+nx}{keyPair}\PYG{p}{.}\PYG{n+nx}{publicKey}\PYG{p}{)}\PYG{p}{;}
\PYG{n+nx}{fs}\PYG{p}{.}\PYG{n+nx}{writeFileSync}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}private\PYGZus{}key.pem\PYGZdq{}}\PYG{p}{,}\PYG{+w}{ }\PYG{n+nx}{keyPair}\PYG{p}{.}\PYG{n+nx}{privateKey}\PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}

\sphinxAtStartPar
keygen:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kd}{const}\PYG{+w}{ }\PYG{n+nx}{crypto}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n+nx}{require}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}crypto\PYGZsq{}}\PYG{p}{)}\PYG{p}{;}
\PYG{k+kd}{const}\PYG{+w}{ }\PYG{n+nx}{fs}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n+nx}{require}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}fs\PYGZsq{}}\PYG{p}{)}\PYG{p}{;}
\PYG{k+kd}{const}\PYG{+w}{ }\PYG{n+nx}{path}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n+nx}{require}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}path\PYGZsq{}}\PYG{p}{)}\PYG{p}{;}
\PYG{k+kd}{const}\PYG{+w}{ }\PYG{n+nx}{root}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n+nx}{\PYGZus{}\PYGZus{}dirname}\PYG{p}{;}
\PYG{k+kd}{function}\PYG{+w}{ }\PYG{n+nx}{doEnc}\PYG{p}{(}\PYG{n+nx}{MachineCode}\PYG{p}{,}\PYG{+w}{ }\PYG{n+nx}{email}\PYG{p}{,}\PYG{+w}{ }\PYG{n+nx}{license}\PYG{p}{)}\PYG{+w}{ }\PYG{p}{\PYGZob{}}
\PYG{+w}{    }\PYG{k+kd}{var}\PYG{+w}{ }\PYG{n+nx}{mc}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n+nb}{JSON}\PYG{p}{.}\PYG{n+nx}{parse}\PYG{p}{(}\PYG{n+nx}{Buffer}\PYG{p}{.}\PYG{k+kr}{from}\PYG{p}{(}\PYG{n+nx}{MachineCode}\PYG{p}{,}\PYG{+w}{ }\PYG{l+s+s1}{\PYGZsq{}base64\PYGZsq{}}\PYG{p}{)}\PYG{p}{.}\PYG{n+nx}{toString}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}\PYG{p}{;}
\PYG{+w}{    }\PYG{k+kd}{var}\PYG{+w}{ }\PYG{n+nx}{signInfo}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{p}{\PYGZob{}}\PYG{+w}{ }\PYG{n+nx}{fingerprint}\PYG{o}{:}\PYG{+w}{ }\PYG{n+nx}{mc}\PYG{p}{.}\PYG{n+nx}{i}\PYG{p}{,}\PYG{+w}{ }\PYG{n+nx}{email}\PYG{p}{,}\PYG{+w}{ }\PYG{n+nx}{license}\PYG{p}{,}\PYG{+w}{ }\PYG{n+nx}{type}\PYG{o}{:}\PYG{+w}{ }\PYG{l+s+s1}{\PYGZsq{}1\PYGZsq{}}\PYG{+w}{ }\PYG{p}{\PYGZcb{}}\PYG{p}{;}
\PYG{+w}{    }\PYG{k}{return}\PYG{+w}{ }\PYG{n+nb}{JSON}\PYG{p}{.}\PYG{n+nx}{stringify}\PYG{p}{(}\PYG{n+nx}{signInfo}\PYG{p}{)}\PYG{p}{;}
\PYG{p}{\PYGZcb{}}

\PYG{k+kd}{const}\PYG{+w}{ }\PYG{n+nx}{privateKey}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n+nx}{fs}\PYG{p}{.}\PYG{n+nx}{readFileSync}\PYG{p}{(}\PYG{n+nx}{path}\PYG{p}{.}\PYG{n+nx}{join}\PYG{p}{(}\PYG{n+nx}{root}\PYG{p}{,}\PYG{+w}{ }\PYG{l+s+s1}{\PYGZsq{}./private\PYGZus{}key.pem\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}\PYG{p}{.}\PYG{n+nx}{toString}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}ascii\PYGZsq{}}\PYG{p}{)}\PYG{p}{;}
\PYG{k+kd}{const}\PYG{+w}{ }\PYG{n+nx}{code}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n+nx}{doEnc}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}eyJ2Ijoid2lufDEuMy42IiwiaSI6IjhqT0VscDBXamsiLCJsIjoiTEFQVE9QLTVBUEZHOTM3IHwgMjYwMTkgfCBXaW5kb3dzIn0=\PYGZdq{}}\PYG{p}{,}\PYG{l+s+s2}{\PYGZdq{}Crack\PYGZus{}By\PYGZus{}Xuqinyang\PYGZdq{}}\PYG{p}{,}\PYG{l+s+s2}{\PYGZdq{}Crack\PYGZus{}By\PYGZus{}Xuqinyang\PYGZdq{}}\PYG{p}{)}\PYG{p}{;}
\PYG{k+kd}{const}\PYG{+w}{ }\PYG{n+nx}{key}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n+nx}{crypto}\PYG{p}{.}\PYG{n+nx}{privateEncrypt}\PYG{p}{(}\PYG{n+nx}{privateKey}\PYG{p}{,}\PYG{+w}{ }\PYG{n+nx}{Buffer}\PYG{p}{.}\PYG{k+kr}{from}\PYG{p}{(}\PYG{n+nx}{code}\PYG{p}{)}\PYG{p}{)}\PYG{p}{.}\PYG{n+nx}{toString}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}base64\PYGZsq{}}\PYG{p}{)}\PYG{p}{;}
\PYG{n+nx}{console}\PYG{p}{.}\PYG{n+nx}{log}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}+\PYGZdq{}}\PYG{o}{+}\PYG{n+nx}{key}\PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}


\subsection{7. 将keygen生成的注册码输入到离线注册窗口并注册}
\label{\detokenize{crack/index:id1}}




\renewcommand{\indexname}{索引}
\printindex
\end{document}